<link rel="import" href="../components/bower_components/polymer/polymer.html">
<!--<link rel="import" href="../imports/layout.html">-->

<!-- Fonts -->
<link rel='import' href='../components/bower_components/font-roboto/roboto.html'>

<!-- Custom Imports -->
<link rel="import" href="../imports/side-nav-contents.html" />
<link rel="import" href="../imports/side-nav-profile.html" />
<link rel="import" href="../imports/sign-in-button.html" />
<link rel="import" href="../views/request-details-overlay.html" />

<dom-module id="request-page">
    <!-- CSS -->
    <link rel="import" type="css" href='../assets/app/css/lfg.css'>

    <style>
        :host {
        }

        .system-tag {
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: 3px;
        }

        .flaticon-update {
            margin-top: 2px !important;
            color: #424242;
        }

        .filter-tags {
            width: 65px;
            margin-top: 2px !important;
            margin-bottom: 2px !important;
        }

        .tag-neutral {
            background-color: #ffffff;
            color: #bdbdbd;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #BDBDBD;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .option-neutral {
            background-color: #f57c00;
            color: #ffffff;
        }

        .option-neutral:hover {
            background-color: #f57c00 !important;
            color: #ffffff;
        }

        .new-request-button {
            display: block;
            background-color: transparent;
            color: #ffffff;
            font-size: 1rem;
            padding: 6px 18px;
            border: solid 2px #ffffff;
            border-radius: 5px;
            cursor: pointer;
            /*width:100%;*/
            margin: 0 15px !important;
            margin-top: 10px !important;
            max-height: 60px !important;
            text-align: center;
            cursor: pointer;
        }

        .new-request-button:hover {
            color: #e65100;
            background-color: #ffff00;
            border-color: #ffff00;
            font-weight: 500;
            box-shadow: 0 2px 5px 0 #e65100;
        }

        .psn-filter-tag {
            background-color: #01579B;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #01579B;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .option-psn {
            background-color: #01579B;
            color: #ffffff !important;
        }

        .option-psn:hover {
            background-color: #01579B !important;
            color: #ffffff !important;
        }

        .xbox-filter-tag {
            background-color: #5DCB17;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #5DCB17;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .option-xbox {
            background-color: #5DCB17;
            color: #ffffff !important;
        }

        .option-xbox:hover {
            background-color: #5DCB17 !important;
            color: #ffffff !important;
        }

        .wii-filter-tag {
            background-color: #03A9F4;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #03A9F4;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .option-wii {
            background-color: #03A9F4;
            color: #ffffff !important;
        }

        .option-wii:hover {
            background-color: #03A9F4 !important;
            color: #ffffff !important;
        }

        .pc-filter-tag {
            background-color: #F44336;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #F44336;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .option-pc {
            background-color: #F44336;
            color: #ffffff !important;
        }

        .option-pc:hover {
            background-color: #F44336 !important;
            color: #ffffff !important;
        }

        [class^="flaticon-"]:before, [class*=" flaticon-"]:before {
            margin-left: 0px !important;
            font-size: 35px !important;
        }

        .requests-logo-link {
            text-decoration: none;
            font-size: 2rem;
            color: #ffffff;
            margin-left: -15px !important;
        }

        .lfg-icon-button {
            --paper-icon-button:{
                cursor: pointer !important;
            };
        }

        input[type=text].request-page {
            background-color: transparent;
            border: none;
            border-bottom: none !important;
            border-radius: 0;
            outline: none;
            height: 3rem;
            width: 100%;
            font-size: 1.5rem !important;
            font-weight: 400;
            margin: 0 0 15px 0;
            padding: 0;
        }

        /* label underline focus color */
        input[type=text].request-page:focus {
            border-bottom: none;
            box-shadow: none;
        }

        /* valid color */
        input[type=text].request-page.valid {
            border-bottom: none !important;
            box-shadow: none !important;
        }

        /* invalid color */
        input[type=text].request-page.invalid {
            border-bottom: none;
            box-shadow: none;
        }

        .request-list-item {
            cursor: pointer;
            min-height: 125px;
            border: none !important;
            /*padding-left:20px !important;*/
            /*margin-bottom:7px;*/
            /*margin-top:7px !important;*/
        }

        .request-list-image {
            border-radius: 5px;
            /*margin-left: -50px;*/
        }

        .request-profile-image {
            width: 30px;
            height: 30px;
            overflow: hidden;
            left: 15px;
            display: inline-block;
            vertical-align: middle;
        }

        .request-list-item-container {
            /*padding: 10px 20px 10px 20px;*/
            padding-top: 10px;
        }

        .lfg-main-toolbar {
            --paper-toolbar-background:{
                background-color: transparent !important;
            };
        }

        .lfg-drawer-toolbar {
            --paper-toolbar:{
                background-color: #EF6C00;
                /*background: url('../assets/app/img/profile_background5.jpg');
                    background-size: 256px 192px;*/
            };
        }

        #paper-header-panel {
            border-bottom: solid 1px #ffffff;
        }

        .lfg-main-header-panel {
            --paper-header-panel-cover-container:{
                border: solid 1px #ffffff;
            };
        }

        .lfg-paper-fab {
            --paper-fab:{
                /*position: fixed;
                    right: 0;
                    bottom: 0;
                     margin-right: 5%;
                     margin-bottom: 3%;*/
                margin-top: -5px;
            }; 
            --paper-fab-background: #e65100;
        }

        .bottom-bar {
            margin-left: 0px !important;
        }

        .content-area {
            padding: 0 15% 15% 15%;
            background-color: #FAFAFA;
        }

        .requests-card-panel {
            width: 100%;
            box-shadow: 0 2px 5px 0 #e65100;
            border-radius: 0px;
            height: 200px !important;
        }

        .request-card-item {
            min-height: 150px !important;
            border-bottom: 1px solid #f9a825;
        }

        .request-card-item .card-item .row {
            margin-bottom: 5px;
        }

        .overlay-cover {
            background-color: rgba(0,0,0,0.75);
        }

        .overlay-card {
            opacity: 1 !important;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),0 1px 5px 0 rgba(0, 0, 0, 0.12),0 3px 1px -2px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .search-loading-item {
            cursor: auto;
        }

        .search-loading-item:hover {
            background-color: #ffffff;
        }

        .rwd-break{
            display:none;
        }

        .dropdown-filters{
            display:none;
        }

        #filter_dropdown{
            margin-left:0px !important;
        }

        .alert-banner{
        }

        @media (max-width: 640px) {
            .requests-logo-link {
                margin-left: 0px;
            }

            .content-area {
                padding: 0;
            }

            .flaticon-update {
                margin-top: 2px !important;
            }

            .profile-icon-row {
                margin-top: -150px !important;
            }

            .request-filter-row{
                display:none !important;
                padding-top:8px !important;
            }

            .dropdown-filters{
                display:block !important;
            }

            .img-extend{
                width:100% !important;
            }

            .request-list-item{
                margin-bottom:30px !important;
                border-bottom: solid 1px #e0e0e0 !important;
                padding-bottom:30px !important;
            }

            .lfg-main-toolbar {
                --paper-toolbar:{
                    height:74px;
                };
            }
        }

    </style>

    <template>
        <!-- ------------------------ Search Box --------------------------------- -->
        <ul id="search_dropdown" class="dropdown-content" style="min-height: 60px; top: 0px !important; left: 0px !important; min-width: 100% !important; position: absolute; opacity: 1; display: block;">
            <li class="search-input-container" style="vertical-align: middle !important; min-height: 60px !important; cursor:auto;">
                <div class="row" style="min-height:100% !important; margin-bottom: 0px;">
                    <div class="col s1" style="margin-top:19px; margin-right:20px;">
                        <paper-icon-button icon="arrow-back" class="grey-text text-darken-1"></paper-icon-button>
                    </div>
                    <div class="col s10 style-scope request-page" style="margin-top: 18px; font-size:1.5rem;">
                        <input id="search_input" type="text" class="validate style-scope request-page" placeholder="Game Title">
                    </div>
                </div>
            </li>
            <li class="divider"></li>
            <li class="search-loading-item center">
                <div class="search-loading-item center center-align" style="display:none; padding:15px;">
                    <div class="preloader-wrapper active" style="height:35px; width:35px;">
                        <div class="spinner-layer spinner-yellow-only">
                            <div class="circle-clipper left">
                                <div class="circle"></div>
                            </div>
                            <div class="gap-patch">
                                <div class="circle"></div>
                            </div>
                            <div class="circle-clipper right">
                                <div class="circle"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
        <!-- ------------------------ Search Box --------------------------------- -->
        <paper-drawer-panel>
            <paper-header-panel mode="seamed" drawer class="orange darken-3">
                <paper-toolbar class="medium-tall lfg-drawer-toolbar">
                    <div class="middle">
                        <side-nav-profile class="center-center"></side-nav-profile>
                    </div>
                </paper-toolbar>
                <div class="fit orange darken-3">
                    <template is="dom-if" if="{{loggedIn}}">
                        <a class="new-request-button" on-click="newRequest">New Request</a>
                    </template>
                    <sign-in-button></sign-in-button>
                    <side-nav-contents></side-nav-contents>
                </div>
            </paper-header-panel>
            <paper-header-panel mode="waterfall" main class="lfg-main-header-panel white">
                <paper-toolbar class="white lfg-main-toolbar">
                    <paper-icon-button icon="menu" class="grey-text" paper-drawer-toggle></paper-icon-button>
                    <div class="layout horizontal wrap request-filter-row">
                        <a class="center center-align filter-tags tag-neutral" data-system="ps3">PS3</a>
                        <a class="center center-align filter-tags tag-neutral" data-system="ps4">PS4</a>
                        <a class="center center-align filter-tags tag-neutral" data-system="xbox360">X360</a>
                        <a class="center center-align filter-tags tag-neutral" data-system="xboxOne">X1</a>
                        <a class="center center-align filter-tags tag-neutral" data-system="wii">Wii</a>
                        <a class="center center-align filter-tags tag-neutral" data-system="wiiu">Wii U</a>
                        <a class="center center-align filter-tags tag-neutral" data-system="pc">PC</a>
                    </div>
                    <div class="dropdown-filters center center-align" display:none; style="width:100% !important; margin-right:10px !important;">
                        <!-- Dropdown Trigger -->
                        <a id="filter_dropdown_btn" class="dropdown-button btn option-neutral" data-activates='filter_dropdown'><span class="filter-btn-text">{{filterButtonText}}</span></a>

                        <!-- Dropdown Structure -->
                        <ul id='filter_dropdown' class='dropdown-content'>
                            <li><a class="grey-text filter-option" data-system="ps3">PS3</a></li>
                            <li><a class="grey-text filter-option" data-system="ps4">PS4</a></li>
                            <li><a class="grey-text filter-option" data-system="xbox360">Xbox 360</a></li>
                            <li><a class="grey-text filter-option" data-system="xboxOne">Xbox One</a></li>
                            <li><a class="grey-text filter-option" data-system="wii">Wii</a></li>
                            <li><a class="grey-text filter-option" data-system="wiiu">Wii U</a></li>
                            <li><a class="grey-text filter-option" data-system="pc">PC</a></li>
                            <li class="divider"></li>
                            <li><a class="grey-text filter-option" data-system="all">All Consoles</a></li>
                        </ul>
                    </div>
                    <div class="flex"></div>
                    <paper-icon-button id="search_button" icon="search" class="grey-text" on-click="showSearch"></paper-icon-button>
                    <ul id='dropdown1' class='dropdown-content'>
                        <template is="dom-repeat" items="[[sortoptions]]">
                            <li><a on-click="changeSort" data-sort$="[[item.column]]">[[item.name]]</a></li>
                        </template>
                    </ul>
                    <div class="middle">
                    </div>
                </paper-toolbar>

                <template is="dom-if" if="{{loggedOut}}">
                    <paper-toolbar id="signin_message" class="orange lfg-main-toolbar alert-banner">
                        <div><label class="white-text" style="font-size:1rem;">Sign in to create a Request</label></div>
                        <div class="flex"></div>
                        <div style="margin-top:5px;">
                            <a id="hide_message" class="white-text" style="cursor:pointer !important; z-index:10000;" on-click="hideMessage">
                                <i class="material-icons">cancel</i>
                            </a>
                        </div>
                    </paper-toolbar>
                </template>

                <template is="dom-if" if="{{emailNotVerified}}">
                    <paper-toolbar id="unverified_message" class="green lfg-main-toolbar alert-banner">
                        <div><label class="white-text" style="font-size:1rem;">Verify your email to receive alerts on your requests.&nbsp;&nbsp;
                                <a on-click="verifyEmail" class="white-text" style="cursor:pointer; font-weight:600;">
                                    <i class="fa fa-paper-plane"></i>&nbsp;
                                    Re-send Verification Email
                                </a>
                            </label>
                        </div>
                        <div class="flex"></div>
                        <div style="margin-top:5px;">
                            <a id="hide_verification_message" class="white-text" style="cursor:pointer !important; z-index:10000;" on-click="hideVerificationMessage">
                                <i class="material-icons">cancel</i>
                            </a>
                        </div>
                    </paper-toolbar>
                </template>

                <div class="white lighten-3" style="margin-bottom:10%;">
                    <ul id="request_list" class="collection request-list-item-container" style="margin-top:0; border:none;">
                        <template is="dom-repeat" items="{{requests}}">
                            <li data-request-key$="[[item.key]]" class="collection-item request-list-item" on-click="loadRequest">
                                <div style="width:100%" class="right right-align">
                                    <h6 class="grey-text" style="font-size: 0.75rem;margin: 0px 20px 0 0;position: absolute;right: 0;">[[getTimeLapse(item.created)]]</h6>
                                </div>
                                <div class="layout horizontal wrap">
                                    <div class="img-extend" style="margin-right:20px;">
                                        <template is="dom-if" if="{{item.images.list_url}}">
                                            <img class="request-list-image" src="[[item.images.list_url]]" width="160" />
                                        </template>
                                        <template is="dom-if" if="{{isImageBlank(item.images.list_url)}}">
                                            <div class="layout vertical center-center white-text" style="background-color:#FB8C00; width:160px; height:90px; border-radius: 5px; padding:0 7px;">
                                                <label class="white-text">{{item.gametitle}}</label>
                                            </div>
                                        </template>
                                    </div>
                                    <div class="request-list-item-details">
                                        <div class="item-content-container">
                                            <div><span class="grey-text text-darken-2" style="font-size:0.75rem;">[[item.gametitle]]</span></div>
                                            <div><span style="font-size:1.15rem; margin-top:-5px; font-weight:500;">[[item.title]]</span></div>
                                            <div><span class="grey-text" style="font-size:0.9rem;">[[item.description]]</span></div>
                                            <div>
                                                <span class="white-text center center-align system-tag" style$="[[item.systemColor]]">[[getSystemType(item.system)]]</span>
                                                <span class="grey-text center center-align" style="background-color:#ffffff; font-size:0.7rem; padding:3px 10px; border:solid 1px #BDBDBD; border-radius:3px;">
                                                    <span class="grey-text text-darken-1">[[getGamerCount(item.gamercount)]]</span>
                                                    &nbsp;
                                                    <i class="fa fa-user grey-text text-lighten-1"></i>
                                                </span>
                                                <template is="dom-if" if="{{item.mic}}">
                                                    <span style="margin-left:7px; vertical-align:text-top;" class="grey-text"><i style="font-size:1.0rem;" class="material-icons">headset_mic</i></span>
                                                </template>

                                                <template is="dom-if" if="{{item.commentCount}}">
                                                    <span style="margin-left:7px;" class="grey-text"><i class="fa fa-comments grey-text"></i>&nbsp;<span style="font-size:0.7rem">{{item.commentCount}}</span></span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex"></div>
                                    <div class="right right-align">
                                        <img id$="{{getImageId(item.key)}}" src="../assets/app/img/profile-photo-placeholder.jpg" alt="" style="position:relative; margin-top:35px; margin-right:15px;" class="circle request-profile-image">
                                    </div>
                                </div>
                                
                            </li>
                        </template>

                        <li class="collection-item request-list-item spinner-roo-item">
                            <div class="row">
                                <div class="col s12 center center-align">
                                    <div class="preloader-wrapper active">
                                        <div class="spinner-layer spinner-yellow-only">
                                            <div class="circle-clipper left">
                                                <div class="circle"></div>
                                            </div>
                                            <div class="gap-patch">
                                                <div class="circle"></div>
                                            </div>
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>

                        <li class="collection-item request-list-item no-more-records-item" style="display:none;">
                            <div class="row">
                                <div class="col s12 center center-align">
                                    <h6 class="grey-text" style="font-size:1.25rem;">
                                        <i class="fa fa-meh-o fa-lg"></i>&nbsp;
                                        That's all there is it seems...
                                    </h6>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>


        <!-- Request Details Overlay-->
        <div id="details_overlay" class="overlay-cover layout horizontal center-center" style="width:100%; height:100% !important; z-index:10000 !important; position:fixed; display:none;">
            <div id="details_overlay_content" class="white overlay-card" style="width:100%; max-width:1000px; height:92% !important; border-radius:5px;">
                <div class="layout vertical white" style="border-radius:5px;">
                    <div class="layout horizontal">
                        <div class="flex"></div>
                        <a id="close_overlay" class="grey-text" style="cursor:pointer !important; margin:7px 7px 0 0;" on-click="closeOverlay">
                            <i class="material-icons small" style="font-size:2rem;">cancel</i>
                        </a>
                    </div>
                </div>

                <div id="overlay_details" style="height:92%; overflow:auto;">
                </div>
            </div>
        </div>
    </template>
</dom-module>

<script>
    (function (window) {
        var constructor = Polymer({

            is: 'request-page',

            /**
             * ...
             *
             * @attribute properties
             * @type object
             * @default
             */
            properties: {
                firebase: {
                    requests: null,
                    games: null,
                    users: null
                },
                name: 'Requests Page',

                /**
                 * ...
                 *
                 * @attribute thingName
                 * @type string
                 * @default ''
                 */
                notify: true
            },

            /* Functions */
            
            addNeutralTag: function (node) {
                $(node).addClass('tag-neutral');
            },

            addSpinnerRoo: function () {
                $('.spinner-roo-item').show();
            },

            activateFilterOption: function(e){
                var cusElem = this;

                //unbind this annoying event - will be rebound if it is.
                $('#mainContainer').unbind('scroll');
                cusElem.scrollBound = false;

                var system = e.target.dataset.system;

                switch (system) {
                    case 'pc':
                        cusElem.systemFilter = 'pc';
                        cusElem.filterButtonText = 'PC';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-pc');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    case 'ps3':
                        cusElem.systemFilter = 'ps3';
                        cusElem.filterButtonText = 'PS3';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-psn');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    case 'ps4':
                        cusElem.systemFilter = 'ps4';
                        cusElem.filterButtonText = 'PS4';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-psn');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    case 'xbox360':
                        cusElem.systemFilter = 'xbox360';
                        cusElem.filterButtonText = 'Xbox 360';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-xbox');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    case 'xboxOne':
                        cusElem.systemFilter = 'xboxOne';
                        cusElem.filterButtonText = 'Xbox One';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-xbox');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    case 'wii':
                        cusElem.systemFilter = 'wii';
                        cusElem.filterButtonText = 'Wii';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-wii');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    case 'wiiu':
                        cusElem.systemFilter = 'wiiu';
                        cusElem.filterButtonText = 'Wii U';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-wii');
                        if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                        }
                        break;

                    default:
                        cusElem.systemFilter = 'none';
                        cusElem.filterButtonText = 'All Consoles';
                        cusElem.clearOptionClass($(cusElem.$.filter_dropdown_btn).get());
                        $(cusElem.$.filter_dropdown_btn).addClass('option-neutral');
                        if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                            cusElem.getRequests(null, cusElem.querytype.none, false);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                        }
                        break;
                }
            },

            activateFilterTag: function (e) {
                var cusElem = this;

                //unbind this annoying event - will be rebound if it is.
                $('#mainContainer').unbind('scroll');
                cusElem.scrollBound = false;

                var system = e.target.dataset.system;

                $('.filter-tags').each(function () {
                    cusElem.clearSystemTagClass($(this).get(0));
                });

                switch (system) {

                    case 'pc':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('pc-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'pc';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;

                    case 'ps3':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('psn-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'ps3';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;

                    case 'ps4':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('psn-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'ps4';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;

                    case 'xbox360':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('xbox-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'xbox360';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;

                    case 'xboxOne':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('xbox-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'xboxOne';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;

                    case 'wii':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('wii-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'wii';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;

                    case 'wiiu':
                        if (!$(e.target).hasClass('filter-active')) {
                            cusElem.clearActiveTag(e.target);
                            cusElem.clearNeutralTagClass(e.target);
                            $(e.target).addClass('wii-filter-tag');
                            $(e.target).addClass('filter-active');
                            cusElem.systemFilter = 'wiiu';
                            if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.bysystem, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
                            }
                        }
                        else {
                            if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                                cusElem.getRequests(null, cusElem.querytype.none, false);
                            }
                            else {
                                cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
                            }
                            $(e.target).removeClass('filter-active');
                            cusElem.systemFilter = 'none';
                        }
                        break;
                }
            },

            authDataCallback: function (authData) {
                var cusElem = this;

                if (authData) {
                    //console.log("User " + authData.uid + " is logged in with " + authData.provider);
                } else {
                    //Check to make sure the user is logged out
                    cusElem.loggedIn = false;
                    cusElem.loggedOut = true;

                    cusElem.notifyPath('loggedIn', cusElem.loggedIn);
                    cusElem.notifyPath('loggedOut', cusElem.loggedOut);
                }
            },

            clearActiveTag: function (exceptionNode) {
                $('.filter-tags').each(function () {
                    if ($(this).data('system') !== $(exceptionNode).data('system')) {
                        $(this).removeClass('filter-active');
                    }
                });
            },

            clearOptionClass: function(node){
                $(node).removeClass('option-psn');
                $(node).removeClass('option-xbox');
                $(node).removeClass('option-wii');
                $(node).removeClass('option-pc');
            },

            clearFirebaseCallbacks: function (name) {
                var cusElem = this;
                if (name !== null && name !== undefined && name !== '') {
                    var callbacks = _.findWhere(cusElem.firebaseRefs, { name: name });
                    if (callbacks) {
                        if (callbacks.isArray) {
                            _.each(callbacks, function (ref, index) {
                                //Detach all currently attached firebase callbacks. Only one should be attached at one time
                                ref.value.off(ref.type, ref.functionRef);
                                cusElem.firebaseRefs.splice(cusElem.firebaseRefs.indexOf(ref), 1);
                            });
                        }
                        else {
                            callbacks.value.off(callbacks.type, callbacks.functionRef);
                            cusElem.firebaseRefs.splice(cusElem.firebaseRefs.indexOf(callbacks), 1);
                        }
                    }
                }
                else {
                    if (cusElem.firebaseRefs.length > 0) {
                        var clone = cusElem.firebaseRefs.slice(0);
                        _.each(clone, function (ref, index) {
                            //Detach all currently attached firebase callbacks. Only one should be attached at one time
                            ref.value.off(ref.type, ref.functionRef);
                            cusElem.firebaseRefs.splice(cusElem.firebaseRefs.indexOf(ref), 1);
                        });
                    }
                }
            },

            clearNeutralTagClass: function (node) {
                $(node).removeClass('tag-neutral');
            },

            clearSystemTagClass: function (node) {
                var system = node.dataset.system;

                switch (system) {

                    case 'pc':
                        $(node).removeClass('pc-filter-tag');
                        this.addNeutralTag(node);
                        break;

                    case 'ps3':
                        $(node).removeClass('psn-filter-tag');
                        this.addNeutralTag(node);
                        break;

                    case 'ps4':
                        $(node).removeClass('psn-filter-tag');
                        this.addNeutralTag(node);
                        break;

                    case 'xbox360':
                        $(node).removeClass('xbox-filter-tag');
                        this.addNeutralTag(node);
                        break;

                    case 'xboxOne':
                        $(node).removeClass('xbox-filter-tag');
                        this.addNeutralTag(node);
                        break;

                    case 'wii':
                        $(node).removeClass('wii-filter-tag');
                        this.addNeutralTag(node);
                        break;

                    case 'wiiu':
                        $(node).removeClass('wii-filter-tag');
                        this.addNeutralTag(node);
                        break;
                }
            },

            closeOverlay: function () {
                $(this.$.details_overlay).fadeOut();
                this.$.overlay_details.innerHTML = '';
                $(this.$.overlay_details).empty();
            },

            changeSort: function (e) {
                var anchor_elem = e.target;
                this.dataops.sort = anchor_elem.dataset.sort;

                //this.getRequests(this.dataops.sort, true);
                this.getRequests(null, this.querytype.none, false);
            },

            containerScroll: function (e) {
                var cusElem = this;
                var container = e.target;
                if (container.offsetHeight + container.scrollTop >= container.scrollHeight) {
                    // reached bottom of page - run our call for pagination..

                    if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                        if (cusElem.systemFilter !== null && cusElem.systemFilter !== undefined && cusElem.systemFilter !== '' && cusElem.systemFilter !== 'none') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, true);
                        }
                        else {
                            cusElem.getRequests(null, this.querytype.none, true);
                            /*cusElem.getRequests(null, cusElem.dataops.querytype, true);*/
                        }
                    }
                    else {
                        if (cusElem.systemFilter !== null && cusElem.systemFilter !== undefined && cusElem.systemFilter !== '' && cusElem.systemFilter !== 'none') {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, true);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, true);
                            /*cusElem.getRequests(cusElem.dataops.query, cusElem.dataops.querytype, true);*/
                        }
                    }
                }
            },

            determineRequestsToGet: function () {
                var pageurl = window.location.href;
                var game = decodeURIComponent(window.lfg.utils.getQueryStringParam('game', pageurl)).replace(/&amp;/g, "&");
                var system = window.lfg.utils.getQueryStringParam('system', pageurl);

                if (game !== null && game !== 'null' && game !== undefined && game !== '' && system !== null && system !== 'null' && system !== undefined && system !== '') {

                    this.dataops.query = game;

                    //Set the search box and current filter to appropriate system
                    $('#search_input').val(game);

                    switch (system) {
                        case 'pc':
                            this.systemFilter = system;
                            $('a[data-system="pc"]').addClass('pc-filter-tag').addClass('filter-active');
                            break;

                        case 'ps3':
                            this.systemFilter = system;
                            $('a[data-system="ps3"]').addClass('psn-filter-tag').addClass('filter-active');
                            break;

                        case 'ps4':
                            this.systemFilter = system;
                            $('a[data-system="ps4"]').addClass('psn-filter-tag').addClass('filter-active');
                            break;

                        case 'xbox360':
                            this.systemFilter = system;
                            $('a[data-system="xbox360"]').addClass('xbox-filter-tag').addClass('filter-active');
                            break;

                        case 'xboxOne':
                            this.systemFilter = system;
                            $('a[data-system="xboxOne"]').addClass('xbox-filter-tag').addClass('filter-active');
                            break;

                        case 'wii':
                            this.systemFilter = system;
                            $('a[data-system="wii"]').addClass('wii-filter-tag').addClass('filter-active');
                            break;

                        case 'wiiu':
                            this.systemFilter = system;
                            $('a[data-system="wiiu"]').addClass('wii-filter-tag').addClass('filter-active');
                            break;
                    }

                    this.getRequests(game, this.querytype.bysystem, false);
                }
                else if (game !== null && game !== 'null' && game !== undefined && game !== '') {
                    this.dataops.query = game;
                    this.getRequests(game, this.querytype.bygame, false);
                }
                else if (system !== null && system !== 'null' && system !== undefined && system !== '') {
                    
                    switch (system) {
                        case 'pc':
                            this.systemFilter = system;
                            $('a[data-system="pc"]').addClass('pc-filter-tag').addClass('filter-active');
                            break;

                        case 'ps3':
                            this.systemFilter = system;
                            $('a[data-system="ps3"]').addClass('psn-filter-tag').addClass('filter-active');
                            break;

                        case 'ps4':
                            this.systemFilter = system;
                            $('a[data-system="ps4"]').addClass('psn-filter-tag').addClass('filter-active');
                            break;

                        case 'xbox360':
                            this.systemFilter = system;
                            $('a[data-system="xbox360"]').addClass('xbox-filter-tag').addClass('filter-active');
                            break;

                        case 'xboxOne':
                            this.systemFilter = system;
                            $('a[data-system="xboxOne"]').addClass('xbox-filter-tag').addClass('filter-active');
                            break;

                        case 'wii':
                            this.systemFilter = system;
                            $('a[data-system="wii"]').addClass('wii-filter-tag').addClass('filter-active');
                            break;

                        case 'wiiu':
                            this.systemFilter = system;
                            $('a[data-system="wiiu"]').addClass('wii-filter-tag').addClass('filter-active');
                            break;
                    }

                    this.getRequests(null, this.querytype.bysystem, false);
                }
                else {
                    this.getRequests(null, this.querytype.none, false);
                }
            },

            doSearch: function (e) {
                var cusElem = this;
                var query = $('#search_input').val();
                var url = window.lfg.config.getGiantBombUrl(window.lfg.config.apiEndPoints.search);
                $('#search_dropdown').find('.search-result-item').remove();
                $('#search_dropdown').find('.search-loading-item').show();

                $.ajax({
                    url: url,
                    type: 'GET',
                    cache: false,
                    data: { search: query, limit: 4 },
                    dataType: 'json',
                    success: function (data) {
                        var html = '';

                        _.each(data.results, function (result) {
                            html += '<li class="search-result-item" data-result-id="' + result.id + '" style="padding: 7px 0px 7px 8.2%;">';

                            if (
                                result.image !== null && result.image !== undefined &&
                                result.image.screen_url !== null &&
                                result.image.screen_url !== undefined &&
                                result.image.screen_url !== '') {
                                html += '<span class="layout horizontal"><span><img src="' + result.image.screen_url + '" width="100" style="margin-right:30px; border-radius:5px;" /></span>';
                            }
                            else {
                                html += '<span style="background-color:#FB8C00; width:100px; height:56px;"></span>';
                            }

                            html += '<span style="padding-top:21px !important;"><a class="search-result-link orange-text text-darken-3">' + result.name + '</span></a></span></li>';
                        });
                        $('#search_dropdown').find('.search-loading-item').hide();
                        $('#search_dropdown').append(html);

                        $('#search_dropdown').find('img').each(function () {
                            cusElem.resolveGbBrokenImage($(this).get(0));
                        });
                    },
                    error: function (err) {
                    }
                });
            },

            doSearchWithEnter: function (e) {
                var query = $('#search_input').val();

                if ((e.keyCode || e.which) === 13) {
                    /* so the idea here is to take a the text and do a "LIKE" type of query to firebase using "startAt" and "endAt".
					 * I'm not sure atm, whether if/when the user selects the suggested option within the search window, I want to -
					 * still do a "LIKE" search or do an "EQUAL TO" search. The user might select the title "Street Fighter" but actually
					 * not want street fighter from the 80s, but street fighter  4. Cuz we are using Giant Bomb as reference, whats returned in the
					 * autocomplete ties to a gameid.
					 *
					 * For now, I'm going to always do a "LIKE" Search. We'll see how it plays out :| */
                    query = query !== null && query !== undefined && query !== '' ? window.lfg.utils.clearWhiteSpace(query) : '';
                    this.dataops.query = query;		//save the query incase we need it for scrolling
                    //this.getRequests(this.dataops.sort, true, query.toLowerCase());

                    //Account for the system filters
                    if (this.systemFilter !== null && this.systemFilter !== undefined && this.systemFilter !== '' && this.systemFilter !== 'none') {
                        this.getRequests(query.toLowerCase(), this.querytype.bysystem, false);
                    }
                    else {
                        if (query !== null && query !== undefined && query !== '') {
                            this.getRequests(query.toLowerCase(), this.querytype.bygame, false);
                        }
                        else {
                            this.getRequests(null, this.querytype.none, false);
                        }
                    }
                    //this.getRequests(query.toLowerCase(), this.querytype.bygame, false);
                    $('#search_dropdown').fadeOut(100);
                }
            },

            doResultSearchWithClick: function (e) {
                var polymer = this;		//bound to polymer elem
                var anchor = e.target;

                var li = $(anchor);
                if (anchor.tagName.toLowerCase() !== 'li') {
                    li = $(anchor).parents('li');
                }

                var giantbombid = $(li).data('resultId');
                var game = $(li).find('.search-result-link').html().toLowerCase();
                game = window.lfg.utils.clearWhiteSpace(game);

                //Account for the system filters
                if (this.systemFilter !== null && this.systemFilter !== undefined && this.systemFilter !== '' && this.systemFilter !== 'none') {
                    polymer.getRequests(game, polymer.querytype.bysystem, false);
                }
                else {
                    polymer.getRequests(game, polymer.querytype.bygame, false);
                }
                e.preventDefault();
            },

            formatDate: function (utc) {
                return window.lfg.utils.convertUtcToLocal(utc);
            },

            getRequests: function (query, querytype, paginate) {
                var customElem = this
                var requestsRef = customElem.firebaseRef.child('requests');

                if (paginate) {
                    //determine query type
                    switch (querytype) {
                        case customElem.querytype.bygame:
                            
                            customElem.removeNoRecordsMessage();
                            query = window.lfg.utils.clearWhiteSpace(query).toLowerCase();

                            //save the query & type (for pagination)
                            this.dataops.query = query;
                            this.dataops.querytype = querytype;

                            //Using a custom index I created to reverse order entries
                            var lastrequest = customElem.requests[customElem.requests.length - 1];

                            var refFunc = requestsRef
								.orderByChild('gameindex')
								.startAt(lastrequest.gameindex)
								.endAt(query + '~')
								.limitToFirst(customElem.dataops.limit + 1)
								.once('value', function (snapshot) {
								    snapshot.forEach(function (childSnapshot) {
								        var request = childSnapshot.val() || {};
								        var lastreq = customElem.requests[customElem.requests.length - 1];

								        request.key = childSnapshot.key();
								        request.systemColor = customElem.getSystemColor(request.system);
								        request.description = customElem.truncateText(request.description, 65);
								        request.title = customElem.truncateText(request.title, 65);
								        customElem.getUserProfile(request);
								        customElem.getCommentCount(request.key);
								        if (request.gameindex !== lastreq.gameindex) {
								            if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								                customElem.firebaseTimestamp = (-1 * request.index);
								                customElem.unshift('requests', request);
								            }
								            else {
								                customElem.push('requests', request);
								            }
								            customElem.notifyPath('requests', customElem.requests);
								        };
								    });
								    customElem.removeSpinnerRoo();

								    var reqCheck = snapshot.val();

								    if (snapshot.val() === null || snapshot.val() === undefined) {
								        customElem.showNoRecordsMessage();
								    }
								});
                            break;

                        case customElem.querytype.byid:

                            customElem.removeNoRecordsMessage();

                            var lastrequest = customElem.requests[customElem.requests.length - 1];

                            //save the query & type (for pagination)
                            customElem.dataops.query = query;
                            customElem.dataops.querytype = querytype;

                            var refFunc = requestsRef
								.orderByChild('giantbombindex')
								.startAt(lastrequest.giantbombindex.toString())
								.endAt(lastrequest.giantbombindex + '~')
								.limitToFirst(customElem.dataops.limit + 1)
								.once('value', function (snapshot) {
								    snapshot.forEach(function (childSnapshot) {
								        var request = childSnapshot.val() || {};
								        var lastreq = customElem.requests[customElem.requests.length - 1];

								        request.key = childSnapshot.key();
								        request.systemColor = customElem.getSystemColor(request.system);
								        request.title = customElem.truncateText(request.title, 65);
								        request.description = customElem.truncateText(request.description, 65);
								        customElem.getUserProfile(request);
								        customElem.getCommentCount(request.key);
								        if (request.giantbombindex !== lastreq.giantbombindex) {
								            if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								                customElem.firebaseTimestamp = (-1 * request.index);
								                customElem.unshift('requests', request);
								            }
								            else {
								                customElem.push('requests', request);
								            }
								            customElem.notifyPath('requests', customElem.requests);
								        };
								    });
								    customElem.removeSpinnerRoo();

								    var reqCheck = snapshot.val();

								    if (snapshot.val() === null || snapshot.val() === undefined) {
								        customElem.showNoRecordsMessage();
								    }
								});
                            break;

                        case customElem.querytype.bysystem:

                            customElem.removeNoRecordsMessage();

                            var lastrequest = customElem.requests[customElem.requests.length - 1];

                            if (query) {
                                query = window.lfg.utils.clearWhiteSpace(query).toLowerCase();
                            }

                            var refFunc = requestsRef
								.orderByChild(query !== null && query !== undefined && query !== '' ? 'systemgameindex' : 'systemindex')
								.startAt(query !== null && query !== undefined && query !== '' ? lastrequest.systemgameindex.toString() : lastrequest.systemindex.toString())
                                .endAt(query !== null && query !== undefined && query !== '' ? lastrequest.system + query + '~' : lastrequest.system + '~')
								.limitToFirst(customElem.dataops.limit + 1)
								.once('value', function (snapshot) {
								    snapshot.forEach(function (childSnapshot) {
								        var request = childSnapshot.val() || {};
								        var lastreq = customElem.requests[customElem.requests.length - 1];

								        request.key = childSnapshot.key();
								        request.systemColor = customElem.getSystemColor(request.system);
								        request.title = customElem.truncateText(request.title, 65);
								        request.description = customElem.truncateText(request.description, 65);
								        customElem.getUserProfile(request);
								        customElem.getCommentCount(request.key);
								        if (request.systemgameindex !== lastreq.systemgameindex) {
								            if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								                customElem.firebaseTimestamp = (-1 * request.index);
								                customElem.unshift('requests', request);
								            }
								            else {
								                customElem.push('requests', request);
								            }
								            customElem.notifyPath('requests', customElem.requests);
								        };
								    });
								    
								    customElem.removeSpinnerRoo();

								    var reqCheck = snapshot.val();

								    if (snapshot.val() === null || snapshot.val() === undefined) {
								        customElem.showNoRecordsMessage();
								    }
								});
                            break;

                        default:

                            customElem.removeNoRecordsMessage();
                            var lastrequest = customElem.requests[customElem.requests.length - 1];

                            //no query, so just go by priority
                            //save the query & type (for pagination)
                            customElem.dataops.querytype = querytype;

                            var refFunc = requestsRef
								.orderByChild('index')
								.startAt(lastrequest.index)
								.limitToFirst(customElem.dataops.limit + 1)
								.once("value", function (snapshot) {
								    snapshot.forEach(function (childSnapshot) {
								        var request = childSnapshot.val() || {};
								        request.key = childSnapshot.key();
								        var lastreq = customElem.requests[customElem.requests.length - 1];

								        request.priority = childSnapshot.getPriority();
								        request.systemColor = customElem.getSystemColor(request.system);
								        request.title = customElem.truncateText(request.title, 65);
								        request.description = customElem.truncateText(request.description, 65);
								        customElem.getUserProfile(request);
								        customElem.getCommentCount(request.key);
								        if (request.index !== lastreq.index) {
								            if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								                customElem.firebaseTimestamp = (-1 * request.index);
								                customElem.unshift('requests', request);
								            }
								            else {
								                customElem.push('requests', request);
								            }
								            customElem.notifyPath('requests', customElem.requests);
								        };
								    });
								    
								    customElem.removeSpinnerRoo();
								    var reqCheck = snapshot.val();

								    if (snapshot.val() === null || snapshot.val() === undefined) {
								        customElem.showNoRecordsMessage();
								    }
								}, function (errorObject) {
								    console.log("The read failed: " + errorObject.code);
								});
                            break;
                    }
                }
                else {
                    customElem.requests = [];
                    //customElem.addSpinnerRoo();

                    switch (querytype) {
                        case customElem.querytype.bygame:
                            //Detach all firebase callbacks
                            customElem.clearFirebaseCallbacks();
                            customElem.removeNoRecordsMessage();
                            customElem.addSpinnerRoo();
                            gameUrlParam = query;
                            query = window.lfg.utils.clearWhiteSpace(query).toLowerCase();	//querying by game title, so prepare query    

                            //save the query & type (for pagination)
                            customElem.dataops.query = query;
                            customElem.dataops.querytype = querytype;

                            var refFunc = requestsRef
								.orderByChild('gameindex')
								.startAt(query)
								.endAt(query + '~')
								.limitToFirst(customElem.dataops.limit)
								.on('child_added', function (snapshot) {
								    var request = snapshot.val() || {};
								    request.key = snapshot.key();
								    request.systemColor = customElem.getSystemColor(request.system);
								    request.title = customElem.truncateText(request.title, 65);
								    request.description = customElem.truncateText(request.description, 65);
								    customElem.getUserProfile(request);
								    customElem.getCommentCount(request.key);
								    
								    if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								        customElem.firebaseTimestamp = (-1 * request.index);
								        customElem.unshift('requests', request);
								    }
								    else {
								        customElem.push('requests', request);
								        customElem.requestRetrievalCounter += 1;

								        //when we've gotten all the requests for the paged-limit, rebind the scroll event
								        if (customElem.requestRetrievalCounter >= customElem.dataops.limit) {
								            if (customElem.scrollBound == false) {
								                $('#mainContainer').scroll(customElem.containerScroll.bind(customElem));
								                customElem.requestRetrievalCounter = 0;
								                customElem.scrollBound = true;
								            }
								        }
								    }

								    customElem.notifyPath('requests', customElem.requests);
								    customElem.removeSpinnerRoo();
								});

                            customElem.setRequestListUrl(gameUrlParam);

                            var timeout = setTimeout(function () {
                                if (customElem.requests == null || customElem.requests == undefined || customElem.requests.length <= 0) {
                                    customElem.removeSpinnerRoo();
                                    customElem.showNoRecordsMessage();
                                }
                            }, 5000);

                            //Store the firebaseRef so we can access it later to detach any callbacks...
                            customElem.firebaseRefs.push({
                                name: 'requests' + '_' + customElem.querytype.bygame + '_nopaginate',
                                type: 'child_added',
                                value: requestsRef,
                                functionRef: refFunc
                            });
                            break;

                        case customElem.querytype.byid:
                            //Detach all firebase callbacks
                            customElem.clearFirebaseCallbacks();
                            customElem.removeNoRecordsMessage();
                            customElem.addSpinnerRoo();

                            //save the query & type (for pagination)
                            var gameUrlParam = query;
                            customElem.dataops.query = query;
                            customElem.dataops.querytype = querytype;

                            var refFunc = requestsRef
								.orderByChild('giantbombindex')
								.startAt(query.toString())
								.endAt(query + '~')
								.limitToFirst(customElem.dataops.limit)
								.on('child_added', function (snapshot) {
								    var request = snapshot.val() || {};
								    request.key = snapshot.key();
								    request.systemColor = customElem.getSystemColor(request.system);
								    request.title = customElem.truncateText(request.title, 65);
								    request.description = customElem.truncateText(request.description, 65);
								    customElem.getUserProfile(request);
								    customElem.getCommentCount(request.key);
								    
								    if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								        customElem.firebaseTimestamp = (-1 * request.index);
								        customElem.unshift('requests', request);
								    }
								    else {
								        customElem.push('requests', request);
								        customElem.requestRetrievalCounter += 1;

								        //when we've gotten all the requests for the paged-limit, rebind the scroll event
								        if (customElem.requestRetrievalCounter >= customElem.dataops.limit) {
								            if (customElem.scrollBound == false) {
								                $('#mainContainer').scroll(customElem.containerScroll.bind(customElem));
								                customElem.requestRetrievalCounter = 0;
								                customElem.scrollBound = true;
								            }
								        }
								    }

								    customElem.notifyPath('requests', customElem.requests);
								    customElem.removeSpinnerRoo();
								});

                            customElem.setRequestListUrl(gameUrlParam);

                            var timeout = setTimeout(function () {
                                if (customElem.requests == null || customElem.requests == undefined || customElem.requests.length <= 0) {
                                    customElem.removeSpinnerRoo();
                                    customElem.showNoRecordsMessage();
                                }
                            }, 5000);

                            //Store the firebaseRef so we can access it later to detach any callbacks
                            customElem.firebaseRefs.push({
                                name: 'requests' + '_' + customElem.querytype.byid + '_nopaginate',
                                type: 'child_added',
                                value: requestsRef,
                                functionRef: refFunc
                            });
                            break;


                        case customElem.querytype.bysystem:
                            //Detach all firebase callbacks
                            var systemUrlParam = customElem.systemFilter;
                            var gameUrlParam = query;

                            customElem.clearFirebaseCallbacks();
                            customElem.removeNoRecordsMessage();
                            customElem.addSpinnerRoo();

                            if (query) {
                                query = window.lfg.utils.clearWhiteSpace(query).toLowerCase();
                            }

                            var refFunc = requestsRef
								.orderByChild( query !== null && query !== undefined && query !== '' ? 'systemgameindex' : 'systemindex')
								.startAt(query !== null && query !== undefined && query !== '' ? customElem.systemFilter + query : customElem.systemFilter)
                                .endAt(query !== null && query !== undefined && query !== '' ? customElem.systemFilter + query + '~' : customElem.systemFilter + '~')
								.limitToFirst(customElem.dataops.limit)
								.on('child_added', function (snapshot) {
								    var request = snapshot.val() || {};
								    request.key = snapshot.key();
								    request.systemColor = customElem.getSystemColor(request.system);
								    request.title = customElem.truncateText(request.title, 65);
								    request.description = customElem.truncateText(request.description, 65);
								    customElem.getUserProfile(request);
								    customElem.getCommentCount(request.key);
								    
								    if ((-1 * request.index) >= customElem.firebaseTimestamp) {
								        customElem.firebaseTimestamp = (-1 * request.index);
								        customElem.unshift('requests', request);
								    }
								    else {
								        customElem.push('requests', request);
								        customElem.requestRetrievalCounter += 1;

								        //when we've gotten all the requests for the paged-limit, rebind the scroll event
								        if (customElem.requestRetrievalCounter >= customElem.dataops.limit) {
								            if (customElem.scrollBound == false) {
								                $('#mainContainer').scroll(customElem.containerScroll.bind(customElem));
								                customElem.requestRetrievalCounter = 0;
								                customElem.scrollBound = true;
								            }
								        }
								    }

								    customElem.notifyPath('requests', customElem.requests);
								    customElem.removeSpinnerRoo();
								});

                            customElem.setRequestListUrl(gameUrlParam, systemUrlParam);

                            var timeout = setTimeout(function () {
                                if (customElem.requests == null || customElem.requests == undefined || customElem.requests.length <= 0) {
                                    customElem.removeSpinnerRoo();
                                    customElem.showNoRecordsMessage();
                                }
                            }, 5000);

                            //Store the firebaseRef so we can access it later to detach any callbacks
                            customElem.firebaseRefs.push({
                                name: 'requests' + '_' + customElem.querytype.bysystem + '_nopaginate',
                                type: 'child_added',
                                value: requestsRef,
                                functionRef: refFunc
                            });
                            break;

                        default:
                            //Detach all firebase callbacks
                            customElem.clearFirebaseCallbacks();
                            customElem.removeNoRecordsMessage();
                            customElem.addSpinnerRoo();

                            //save the query & type (for pagination)
                            customElem.dataops.querytype = querytype;

                            var refFunc = requestsRef
								.orderByChild('index')
								.limitToFirst(customElem.dataops.limit)
								.on("child_added", function (snapshot) {
								    var request = snapshot.val() || {};
								    request.key = snapshot.key();
								    request.priority = snapshot.getPriority();
								    request.systemColor = customElem.getSystemColor(request.system);
								    request.title = customElem.truncateText(request.title, 65);
								    request.description = customElem.truncateText(request.description, 65);
								    customElem.getUserProfile(request);
								    customElem.getCommentCount(request.key);

								    var reqIndex = (-1 * parseInt(request.index));

								    if (reqIndex >= parseInt(customElem.firebaseTimestamp)) {
								        customElem.firebaseTimestamp = (-1 * request.index);
								        customElem.unshift('requests', request);
								    }
								    else {
								        customElem.push('requests', request);
								        customElem.requestRetrievalCounter += 1;

								        //when we've gotten all the requests for the paged-limit, rebind the scroll event
								        if (customElem.requestRetrievalCounter >= customElem.dataops.limit) {
								            if (customElem.scrollBound == false) {
								                $('#mainContainer').scroll(customElem.containerScroll.bind(customElem));
								                customElem.requestRetrievalCounter = 0;
								                customElem.scrollBound = true;
								            }
								        }
								    }

								    customElem.notifyPath('requests', customElem.requests);
								    customElem.removeSpinnerRoo();

								}, function (errorObject) {
								    console.log("The read failed: " + errorObject.code);
								});

                            customElem.setRequestListUrl();

                            //This is realy a hack for the firebase child_added event. Because if there are no records to return,
                            //the child_added nevr gets called, we need to set a timeout to remove tge spinner and display a message if there's nothing
                            //to return back - otherwise, the spinner keeps spinning - making the user think the app is taking too long
                            //There is a chance in fact that the app might be taking too long. In this case, the error callback on child added should
                            //remove the spinneroo and put the appropriate message
                            //5 second time out - hope it's not too small - but Firebase is really first though
                            var timeout = setTimeout(function () {
                                if (customElem.requests == null || customElem.requests == undefined || customElem.requests.length <= 0) {
                                    customElem.removeSpinnerRoo();
                                    customElem.showNoRecordsMessage();
                                }
                            }, 5000);

                            //Store the firebaseRef so we can access it later to detach any callbacks
                            customElem.firebaseRefs.push({
                                name: 'requests' + '_' + customElem.querytype.none + '_nopaginate',
                                type: 'child_added',
                                value: requestsRef,
                                functionRef: refFunc
                            });
                            break;
                    }
                }
            },

            getCommentCount: function (requestid) {
                var customElem = this
                var commentsRef = customElem.firebaseRef.child('comments');

                commentsRef
					.orderByChild('requestkey')
					.equalTo(requestid)
					.once('value', function (snapshot) {
					    var comment = snapshot.val();

					    if (comment) {
					        var request = _.findWhere(customElem.requests, { key: requestid });

					        if (request) {
					            request.commentCount = request.commentCount ? request.commentCount + 1 : 1;
					        }
					    }
					});
            },

            getImageId: function (key) {
                return 'img' + key;
            },

            getTimeLapse: function (date) {
                var convDate = new Date(date);
                return window.lfg.utils.timeSince(date);
            },

            getUserProfile: function (request) {
                var cusElem = this;
                var userImageRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + request.uid + '/profilepic');
                userImageRef.once("value", function (snapshot) {
                    var profilepic = snapshot.val();
                    if (profilepic !== null && profilepic !== undefined && profilepic !== '') {
                        var profileImage = document.getElementById("img" + request.key);

                        if (profileImage !== null && profileImage !== undefined) {
                            document.getElementById("img" + request.key).src = profilepic;
                        }
                    }
                });
            },

            getGamerCount: function (count) {
                if (count <= 1) {
                    return '1';
                }
                else {
                    return count;
                }
            },

            getSystemType: function (system) {

                switch (system) {

                    case 'pc':
                        return 'PC';
                        break;

                    case 'ps3':
                        return 'PS3';
                        break;

                    case 'ps4':
                        return 'PS4';
                        break;

                    case 'xbox360':
                        return 'X360';
                        break;

                    case 'xboxOne':
                        return 'X1';
                        break;

                    case 'wii':
                        return 'Wii';
                        break;

                    case 'wiiu':
                        return 'Wii U';
                        break;
                }
            },

            getSystemColor: function (system) {

                switch (system) {

                    case 'pc':
                        return 'background-color: #f44336;';
                        break;

                    case 'ps3':
                        return 'background-color: #01579b;';
                        break;

                    case 'ps4':
                        return 'background-color: #01579b;';
                        break;

                    case 'xbox360':
                        return 'background-color: #5DCB17;';
                        break;

                    case 'xboxOne':
                        return 'background-color: #5DCB17;';
                        break;

                    case 'wii':
                        return 'background-color: #03a9f4;';
                        break;

                    case 'wiiu':
                        return 'background-color: #03a9f4;';
                        break;
                }
            },

            hideMessage: function (e) {
                $('#signin_message').slideUp();
            },

            hideVerificationMessage: function(e){
                $('#unverified_message').slideUp();
            },

            isUserEmailVerified: function () {
                var cusElem = this;
                var loggedIn = window.lfg.utils.isLoggedIn();

                if (loggedIn) {
                    var uid = window.lfg.utils.getUser();
                    if (uid) {
                        var emailVerifiedRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + uid + '/emailverified');

                        emailVerifiedRef.once('value', function (snapshot) {
                            var verified = snapshot.val();
                            cusElem.emailNotVerified = !verified ? true : false;
                            cusElem.notifyPath('emailVerified', cusElem.emailVerified);
                        });
                    }
                }
            },

            isImageBlank: function (url) {
                return (url == null || url == undefined || url == '');
            },

            isLoggedIn: function () {
                var cusElem = this;

                if (window.lfg.utils.isLoggedIn()) {
                    var uid = window.lfg.utils.getUser();
                    var userRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + uid);

                    //Get the user profile info. If none exists, redirect to Onboarding process...
                    userRef
                        .once('value', function (snapshot) {
                            var user = snapshot.val();
                            //redirect to user setup page
                            if (user === null || user === undefined || user.setupcomplete === null || user.setupcomplete === undefined || user.setupcomplete === '' || user.setupcomplete === false) {
                                cusElem.loggedIn = false;
                            }
                            else {
                                cusElem.loggedIn = true;
                            }
                        });
                }
            },

            isLoggedOut: function () {
                var cusElem = this;
                var uid = window.lfg.utils.getUser();

                if (window.lfg.utils.isLoggedIn()) {
                    var userRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + uid);

                    //Get the user profile info. If none exists, redirect to Onboarding process...
                    userRef
                        .once('value', function (snapshot) {
                            var user = snapshot.val();
                            //redirect to user setup page
                            if (user === null || user === undefined || user.setupcomplete === null || user.setupcomplete === undefined || user.setupcomplete === '' || user.setupcomplete === false) {
                                cusElem.loggedOut = true;
                            }
                            else {
                                cusElem.loggedOut = false;
                            }
                        });
                }
                else {
                    cusElem.loggedOut = true;
                }
            },

            loadRequest: function (e) {
                var listelem = e.target;
                if (listelem.className.indexOf('request-card-item') === -1 && listelem.className.indexOf('request-list-item') === -1) {
                    var elem = $(listelem).parents('.request-card-item')[0];
                    listelem = elem === null || elem === undefined ? $(listelem).parents('.request-list-item')[0] : elem;
                }

                var requestkey = listelem.dataset.requestKey;
                if (requestkey) {
                    //document.querySelector('app-router').go('/request/' + requestkey);
                    //var detailsHtml = '<request-details-overlay requestkey="' + requestkey + '"></request-details-overlay>';
                    var dynamicEl = document.createElement("request-details-overlay");

                    //dynamicEl.requestkey = this.requestkey;
                    dynamicEl.setAttribute('requestkey', requestkey);
                    this.$.overlay_details.innerHTML = '';
                    this.$.overlay_details.appendChild(dynamicEl);
                    $(this.$.details_overlay).fadeIn();
                }
            },

            removeSpinnerRoo: function () {
                $('.spinner-roo-item').hide();
            },

            removeNoRecordsMessage: function(){
                $('.no-more-records-item').hide();
            },

            resolveGbBrokenImage: function (imgElem) {
                //Giantbomb Hack - switch the url from whatever it is to .png or .jpg. (Most of the onerror solutions just wouldnt work)
                var http = jQuery.ajax({
                    type: "HEAD",
                    url: imgElem.src,
                    success: function (data, textStatus, xhr) {
                        if (xhr.status == 404) {
                            var ext = imgElem.src.substring(((imgElem.src.length - 1) - 3));
                            switch (ext.toLowerCase()) {
                                case '.png':
                                    var oldExt = imgElem.src.substring(((imgElem.src.length - 1) - 3));
                                    imgElem.src = imgElem.src.replace(oldExt, '.jpg');
                                    break;

                                case '.jpg':
                                    var oldExt = imgElem.src.substring(((imgElem.src.length - 1) - 3));
                                    imgElem.src = imgElem.src.replace(oldExt, '.png');
                                    break;
                            }
                        }
                    },
                    error: function (error) {
                        if (error.status == 404) {
                            var ext = imgElem.src.substring(((imgElem.src.length - 1) - 3));
                            switch (ext.toLowerCase()) {
                                case '.png':
                                    var oldExt = imgElem.src.substring(((imgElem.src.length - 1) - 3));
                                    imgElem.src = imgElem.src.replace(oldExt, '.jpg');
                                    break;

                                case '.jpg':
                                    var oldExt = imgElem.src.substring(((imgElem.src.length - 1) - 3));
                                    imgElem.src = imgElem.src.replace(oldExt, '.png');
                                    break;
                            }
                        }
                    }
                });
            },

            setRequestListUrl: function (game, system) {
                var url = window.lfg.utils.getSharableRequestListUrl(game, system);

                if(url !== null && url !== undefined && url !== ''){
                    window.history.pushState('object or string', 'Request List', url);
                }
            },

            showNoRecordsMessage: function () {
                $('.no-more-records-item').fadeIn();
            },

            showFilter: function () {
                $(this.$.filter_modal).openModal();
            },

            showSearch: function () {
                $(this.$.search_dropdown).fadeIn(100, function () {
                    $('#search_input').focus();
                });
            },

            truncateText: function (text, limit) {
                //TODO: Factor in the window/screen size
                var width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);

                if (width <= 640) {
                    return text.length <= 30 ? text : text.substring(0, 30) + '...';
                }
                else {
                    return text.length <= limit ? text : text.substring(0, limit) + '...';
                }
            },

            verifyEmail: function(e){
                window.lfg.utils.sendVerificationEmail();
                $('#unverified_message').slideUp();
            },

            /* Init */
            initializeData: function () {
                this.loggedIn = null;
                this.loggedOut = null;
                this.emailNotVerified = null;

                this.isLoggedIn();
                this.isLoggedOut();
                this.isUserEmailVerified();

                this.firebaseUrl = window.lfg.config.getFirebaseUrl() + '/requests';

                this.systems = [
					{ name: 'PC', value: 'pc' },
					{ name: 'PS3', value: 'ps3' },
					{ name: 'PS4', value: 'ps4' },
					{ name: 'Xbox 360', value: 'xbox360' },
					{ name: 'Xbox One', value: 'xboxOne' },
					{ name: 'Wii', value: 'wii' },
					{ name: 'Wii U', value: 'wiiu' }
                ];

                this.sortoptions = [
					{ name: 'Date Created', column: 'created' },
					{ name: 'Game', column: 'game' },
                ];

                this.querytype = {
                    bygame: 'bygame',
                    byid: 'byid',
                    bysystem: 'bysystem',
                    none: 'none'
                };

                this.filterButtonText = 'All Consoles';

                this.systemFilter = 'none';

                this.dataops = {
                    orderby: '',
                    sort: 'created',
                    filter: '',
                    query: '',
                    type: this.querytype.none,
                    limit: 10,
                }

                this.firebaseRef = new Firebase(window.lfg.config.getFirebaseUrl());
                this.firebaseRefs = [];
                this.firebaseTimestamp = (-1 * (0 - Date.now()));
                this.requestRetrievalCounter = 0;
                this.scrollBound = true;

                this.requests = [];

                //hide elements
                $(this.$.filter_modal).hide();
                $(this.$.search_dropdown).hide();

                //login/logout event listener
                var ref = new Firebase(window.lfg.config.getFirebaseUrl());
                ref.onAuth(this.authDataCallback.bind(this));
            },

            registerEvents: function () {
                $('#search_input').on('focusout', function () { $('#search_dropdown').fadeOut(100); })
                $('#search_input').on('input', _.debounce(this.doSearch.bind(this), 1000));
                $('#search_input').on('keypress', this.doSearchWithEnter.bind(this));
                $('#mainContainer').scroll(this.containerScroll.bind(this));
                $(document).on('click', '.search-result-item', this.doResultSearchWithClick.bind(this));
                $('.filter-tags').click(this.activateFilterTag.bind(this));
                $(document).on('click', '.filter-option', this.activateFilterOption.bind(this));

                //clear all auth callbacks
                window.lfg.config.detachAllAuthCallbacks();

                var ref = new Firebase(window.lfg.config.getFirebaseUrl());
                ref.onAuth(this.authDataCallback.bind(this));
            },

            registerPlugins: function () {
                $(this.$.sort_menu).dropdown({
                    inDuration: 300,
                    outDuration: 225,
                    constrain_width: false, // Does not change width of dropdown to that of the activator
                    hover: false, // Activate on hover
                    gutter: 0, // Spacing from edge
                    belowOrigin: false // Displays dropdown below the button
                });

                $(this.$.filter_dropdown_btn).dropdown({
                    inDuration: 300,
                    outDuration: 225,
                    constrain_width: false, // Does not change width of dropdown to that of the activator
                    hover: false, // Activate on hover
                    gutter: 0, // Spacing from edge
                    belowOrigin: false // Displays dropdown below the button
                });

                $(this.$.filter_dropdown).width($(this.$.filter_dropdown_btn).outerWidth(true) + 85);
                //alert($(this.$.filter_dropdown_btn).outerWidth(true));
            },

            /* Events */
            newRequest: function (e) {
                e.preventDefault();
                document.querySelector('app-router').go('/new');
            },

            ready: function () {
                
                this.initializeData();
            },

            attached: function () {
                //this.getRequests(this.dataops.sort);
                //this.getRequests(null, this.querytype.none, false);
                this.determineRequestsToGet();
                this.registerPlugins();
                this.registerEvents();
            }
        });
    })(window);
</script>

<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-66975307-1', 'auto');
 ga('send', 'pageview');

</script>
