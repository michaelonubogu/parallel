<link rel="import" href="../components/bower_components/polymer/polymer.html">
<!--<link rel="import" href="../imports/layout.html">-->

<!-- Fonts -->
<link rel='import' href='../components/bower_components/font-roboto/roboto.html'>


<!-- Custom Imports -->
<link rel="import" href="../imports/side-nav-contents.html" />
<link rel="import" href="../imports/side-nav-profile.html" />
<link rel="import" href="../imports/sign-in-button.html" />
<link rel="import" href="../views/request-details-overlay.html" />

<dom-module id="recent-requests">
    <!-- CSS -->
    <link rel="import" type="css" href='../assets/app/css/lfg.css'>

    <style>
        :host {
        }

        .system-tag {
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: 3px;
        }

        .flaticon-update {
            margin-top: 2px !important;
            color: #424242;
        }

        .filter-tags {
            width: 65px;
            margin-top: 2px !important;
            margin-bottom: 2px !important;
        }

        .tag-neutral {
            background-color: #ffffff;
            color: #bdbdbd;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #BDBDBD;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .new-request-button {
            display: block;
            background-color: transparent;
            color: #ffffff;
            font-size: 1rem;
            padding: 6px 18px;
            border: solid 2px #ffffff;
            border-radius: 5px;
            cursor: pointer;
            /*width:100%;*/
            margin: 0 15px !important;
            margin-top: 10px !important;
            max-height: 60px !important;
            text-align: center;
            cursor: pointer;
        }

        .new-request-button:hover {
            color: #e65100;
            background-color: #ffff00;
            border-color: #ffff00;
            font-weight: 500;
            box-shadow: 0 2px 5px 0 #e65100;
        }

        .psn-filter-tag {
            background-color: #01579B;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #01579B;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .xbox-filter-tag {
            background-color: #5DCB17;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #5DCB17;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .wii-filter-tag {
            background-color: #03A9F4;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #03A9F4;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        .pc-filter-tag {
            background-color: #F44336;
            color: #ffffff !important;
            font-size: 1rem;
            padding: 3px 13px;
            border: solid 2px #F44336;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            max-height: 30px !important;
        }

        [class^="flaticon-"]:before, [class*=" flaticon-"]:before {
            margin-left: 0px !important;
            font-size: 35px !important;
        }

        .logo-link {
            text-decoration: none;
            font-size: 2rem;
            color: #ffffff;
            margin-left: -15px !important;
        }

        .lfg-icon-button {
            --paper-icon-button:{
                cursor: pointer !important;
            };
        }

        input[type=text].recent-requests {
            background-color: transparent;
            border: none;
            border-bottom: none !important;
            border-radius: 0;
            outline: none;
            height: 3rem;
            width: 100%;
            font-size: 1.5rem !important;
            font-weight: 400;
            margin: 0 0 15px 0;
            padding: 0;
        }

        /* label underline focus color */
        input[type=text].recent-requests:focus {
            border-bottom: none;
            box-shadow: none;
        }

        /* valid color */
        input[type=text].recent-requests.valid {
            border-bottom: none !important;
            box-shadow: none !important;
        }

        /* invalid color */
        input[type=text].recent-requests.invalid {
            border-bottom: none;
            box-shadow: none;
        }

        .request-list-item {
            cursor: pointer;
            min-height: 125px;
            border: none !important;
        }


        .item-content-container {
            /*margin-left: -65px;*/
        }

        .request-list-image {
            border-radius: 5px;
            /*margin-left: -50px;*/
        }

        .request-profile-image {
            width: 30px;
            height: 30px;
            overflow: hidden;
            left: 15px;
            display: inline-block;
            vertical-align: middle;
        }

        .request-list-item-container {
            /*padding: 10px 20px 10px 20px;*/
            padding-top: 10px;
        }

        .lfg-main-toolbar {
            --paper-toolbar-background:{
                background-color: transparent !important;
            };
        }

        .lfg-drawer-toolbar {
            --paper-toolbar:{
                background-color: #EF6C00;
            };
        }

        #paper-header-panel {
            border-bottom: solid 1px #ffffff;
        }

        .lfg-main-header-panel {
            --paper-header-panel-cover-container:{
                border: solid 1px #ffffff;
            };
        }

        .lfg-paper-fab {
            --paper-fab:{
                margin-top: -5px;
            }; 
            --paper-fab-background: #e65100;
        }

        .bottom-bar {
            margin-left: 0px !important;
        }

        .content-area {
            padding: 0 15% 15% 15%;
            background-color: #FAFAFA;
        }

        .requests-card-panel {
            width: 100%;
            box-shadow: 0 2px 5px 0 #e65100;
            border-radius: 0px;
            height: 200px !important;
        }

        .request-card-item {
            min-height: 150px !important;
            border-bottom: 1px solid #f9a825;
        }

        .request-card-item .card-item .row {
            margin-bottom: 5px;
        }

        .overlay-cover {
            background-color: rgba(0,0,0,0.75);
        }

        .overlay-card {
            opacity: 1 !important;
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),0 1px 5px 0 rgba(0, 0, 0, 0.12),0 3px 1px -2px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        @media (max-width: 640px) {
            .logo-link {
                margin-left: 0px;
            }

            .content-area {
                padding: 0;
            }

            .requests-logo-link {
                margin-left: 0px;
            }

            .content-area {
                padding: 0;
            }

            .flaticon-update {
                margin-top: 2px !important;
            }

            .profile-icon-row {
                margin-top: -150px !important;
            }

            .request-filter-row{
                display:none !important;
                padding-top:8px !important;
            }

            .dropdown-filters{
                display:block !important;
            }

            .img-extend{
                width:100% !important;
            }

            .request-list-item{
                margin-bottom:30px !important;
                border-bottom: solid 1px #e0e0e0 !important;
                padding-bottom:30px !important;
            }

            .lfg-paper-fab {
                --paper-fab:{
                    margin-top: -5px;
                }; 
                --paper-fab-background: #e65100;
            }

            .flaticon-update {
                margin-top: 2px !important;
            }

            .profile-icon-row {
                margin-top: -150px !important;
            }
        }

    </style>

    <template>
        <!-- ------------------------ Search Box --------------------------------- -->
        <ul id="search_dropdown" class="dropdown-content" style="min-height: 60px; top: 0px !important; left: 0px !important; min-width: 100% !important; position: absolute; opacity: 1; display: block;">
            <li class="search-input-container" style="vertical-align: middle !important; min-height: 60px !important; cursor:auto;">
                <div class="row" style="min-height:100% !important; margin-bottom: 0px;">
                    <div class="col s1" style="margin-top:19px;">
                        <paper-icon-button icon="arrow-back" class="grey-text text-darken-1"></paper-icon-button>
                    </div>
                    <div class="col s11 style-scope recent-requests" style="margin-top: 18px; font-size:1.5rem;">
                        <input id="search_input" type="text" class="validate style-scope recent-requests" placeholder="Game Title">
                    </div>
                </div>
            </li>
        </ul>
        <!-- ------------------------ Search Box --------------------------------- -->
        <paper-drawer-panel>
            <paper-header-panel mode="seamed" drawer class="orange darken-3">
                <paper-toolbar class="medium-tall lfg-drawer-toolbar">
                    <div class="middle">
                        <side-nav-profile class="center-center"></side-nav-profile>
                    </div>
                </paper-toolbar>
                <div class="fit orange darken-3">
                    <template is="dom-if" if="{{loggedIn}}">
                        <a class="new-request-button" on-click="newRequest">New Request</a>
                    </template>
                    <sign-in-button></sign-in-button>
                    <side-nav-contents></side-nav-contents>
                </div>
            </paper-header-panel>
            <paper-header-panel mode="waterfall" main class="lfg-main-header-panel white">
                <paper-toolbar class="white lfg-main-toolbar">
                    <paper-icon-button icon="menu" class="grey-text" paper-drawer-toggle></paper-icon-button>
                    <paper-icon-button class="grey-text" icon="arrow-back" on-click="goToList"></paper-icon-button>
                    <div class="flex"></div>
                    <!--<paper-icon-button id="search_button" icon="search" class="grey-text" on-click="showSearch"></paper-icon-button>-->
                    <ul id='dropdown1' class='dropdown-content'>
                        <template is="dom-repeat" items="[[sortoptions]]">
                            <li><a on-click="changeSort" data-sort$="[[item.column]]">[[item.name]]</a></li>
                        </template>
                    </ul>
                    <div class="middle">
                    </div>
                    <div class="bottom" style="width:100%;">
                        <!--<div class="layout horizontal wrap filter-row">
                            <span class="center center-align filter-tags tag-neutral" data-system="ps3">PS3</span>
                            <span class="center center-align filter-tags tag-neutral" data-system="ps4">PS4</span>
                            <span class="center center-align filter-tags tag-neutral" data-system="xbox360">X360</span>
                            <span class="center center-align filter-tags tag-neutral" data-system="xboxOne">X1</span>
                            <span class="center center-align filter-tags tag-neutral" data-system="wii">Wii</span>
                            <span class="center center-align filter-tags tag-neutral" data-system="wiiu">Wii U</span>
                            <span class="center center-align filter-tags tag-neutral" data-system="pc">PC</span>
                        </div>-->
                    </div>
                </paper-toolbar>

                <template is="dom-if" if="{{isLoggedOut()}}">
                    <paper-toolbar id="signin_message" class="orange lfg-main-toolbar">
                        <div><label class="white-text" style="font-size:1rem;">Sign in to create a Request</label></div>
                        <div class="flex"></div>
                        <div style="margin-top:5px;">
                            <a id="hide_message" class="white-text" style="cursor:pointer !important; z-index:10000;" on-click="hideMessage">
                                <i class="material-icons">cancel</i>
                            </a>
                        </div>
                    </paper-toolbar>
                </template>

                <div id="recent_requests_content" class="white lighten-3" style="margin-bottom:10%;">
                    <ul id="request_list" class="collection request-list-item-container" style="margin-top:0; border:none;">

                        <template is="dom-repeat" items="{{recentRequests}}">
                            <li data-request-key$="[[item.request.key]]" class="collection-item request-list-item" on-click="loadRequest">
                                <div style="width:100%" class="right right-align">
                                    <h6 class="grey-text" style="font-size: 0.75rem;margin: 0px 20px 0 0;position: absolute;right: 0;">[[getTimeLapse(item.request.created)]]</h6>
                                </div>
                                <div class="layout horizontal wrap">
                                    <div class="img-extend" style="margin-right:20px;">
                                        <template is="dom-if" if="{{item.request.images.list_url}}">
                                            <img class="request-list-image" src="[[item.request.images.list_url]]" width="160" />
                                        </template>
                                        <template is="dom-if" if="{{isImageBlank(item.request.images.list_url)}}">
                                            <div class="layout vertical center-center white-text" style="background-color:#FB8C00; width:160px; height:90px; border-radius: 5px; padding:0 7px;">
                                                <label class="white-text">{{item.request.gametitle}}</label>
                                            </div>
                                        </template>
                                    </div>
                                    <div class="request-list-item-details">
                                        <div class="item-content-container">
                                            <div><span class="grey-text text-darken-2" style="font-size:0.75rem;">[[item.request.gametitle]]</span></div>
                                            <div><span style="font-size:1.15rem; margin-top:-5px; font-weight:500;">[[item.request.title]]</span></div>
                                            <div><span class="grey-text" style="font-size:0.9rem;">[[item.request.description]]</span></div>
                                            <div>
                                                <span class="white-text center center-align system-tag" style$="[[item.request.systemColor]]">[[getSystemType(item.request.system)]]</span>
                                                <span class="grey-text center center-align" style="background-color:#ffffff; font-size:0.7rem; padding:3px 10px; border:solid 1px #BDBDBD; border-radius:3px;">
                                                    <span class="grey-text text-darken-1">[[getGamerCount(item.request.gamercount)]]</span>
                                                    &nbsp;
                                                    <i class="fa fa-user grey-text text-lighten-1"></i>
                                                </span>
                                                <template is="dom-if" if="{{item.request.mic}}">
                                                    <span style="margin-left:7px; vertical-align:text-top;" class="grey-text"><i style="font-size:1.0rem;" class="material-icons">headset_mic</i></span>
                                                </template>

                                                <template is="dom-if" if="{{item.request.commentCount}}">
                                                    <span style="margin-left:7px;" class="grey-text"><i class="fa fa-comments grey-text"></i>&nbsp;<span style="font-size:0.7rem">{{item.request.commentCount}}</span></span>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex"></div>
                                    <div class="right right-align">
                                        <img id$="{{item.request.profilepicid}}" src="../assets/app/img/profile-photo-placeholder.jpg" alt="" style="position:relative; margin-top:35px; margin-right:15px;" class="circle request-profile-image">
                                    </div>
                                </div>

                            </li>
                        </template>
                        
                        <!--<template is="dom-repeat" items="{{recentRequests}}">
                            <li data-request-key$="[[item.request.key]]" class="collection-item request-list-item" on-click="loadRequest">
                                <div style="width:100%" class="right right-align">
                                    <h6 class="grey-text" style="font-size: 0.75rem;margin: 0px 20px 0 0;position: absolute;right: 0;">[[getTimeLapse(item.request.datetime)]]</h6>
                                </div>
                                <div class="row">
                                    <div class="col s10 layout horizontal">
                                        <div style="margin-right:20px;">
                                            <template is="dom-if" if="{{item.request.images.list_url}}">
                                                <img class="request-list-image" src="[[item.request.images.list_url]]" width="160" />
                                            </template>
                                            <template is="dom-if" if="{{isImageBlank(item.request.images.list_url)}}">
                                                <div class="layout vertical center-center white-text" style="background-color:#FB8C00; width:160px; height:90px; border-radius: 5px; padding:0 7px;">
                                                    <label class="white-text">{{item.request.gametitle}}</label>
                                                </div>
                                            </template>
                                        </div>
                                        <div>
                                            <div class="item-content-container">
                                                <div><span class="grey-text text-darken-2" style="font-size:0.75rem;">[[item.request.gametitle]]</span></div>
                                                <div><span style="font-size:1.15rem; margin-top:-5px; font-weight:500;">[[item.request.title]]</span></div>
                                                <div><span class="grey-text" style="font-size:0.9rem;">[[item.request.description]]</span></div>
                                                <div>
                                                    <span class="white-text center center-align system-tag" style$="[[item.request.systemColor]]">[[getSystemType(item.request.system)]]</span>
                                                    <span class="grey-text text-lighten-1 center center-align" style="background-color:#ffffff; font-size:0.7rem; padding:3px 10px; border:solid 1px #BDBDBD; border-radius:5px;">[[getGamerCount(item.request.gamercount)]]</span>
                                                    <template is="dom-if" if="{{item.request.mic}}">
                                                        <span style="margin-left:7px; vertical-align:text-top;" class="grey-text"><i style="font-size:1.0rem;" class="material-icons">headset_mic</i></span>
                                                    </template>

                                                    <template is="dom-if" if="{{item.request.commentCount}}">
                                                        <span style="margin-left:7px;" class="grey-text"><i class="fa fa-comments grey-text"></i>&nbsp;<span style="font-size:0.7rem">{{item.request.commentCount}}</span></span>
                                                    </template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col s2 right right-align">
                                        <img class="circle request-profile-image" id$="{{item.request.profilepicid}}" src="../assets/app/img/profile-photo-placeholder.jpg" alt="" style="position:relative; margin-top:35px; margin-right:15px;">
                                    </div>
                                </div>
                            </li>
                        </template>-->

                        <li class="collection-item request-list-item spinner-roo-item">
                            <div class="row">
                                <div class="col s12 center center-align">
                                    <div class="preloader-wrapper active">
                                        <div class="spinner-layer spinner-yellow-only">
                                            <div class="circle-clipper left">
                                                <div class="circle"></div>
                                            </div>
                                            <div class="gap-patch">
                                                <div class="circle"></div>
                                            </div>
                                            <div class="circle-clipper right">
                                                <div class="circle"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>

                        <li class="collection-item request-list-item no-more-records-item" style="display:none;">
                            <div class="row">
                                <div class="col s12 center center-align">
                                    <h6 class="grey-text" style="font-size:1.25rem;">
                                        <i class="fa fa-meh-o fa-lg"></i>&nbsp;
                                        That's all there is it seems...
                                    </h6>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!--<paper-fab icon="add" class="lfg-paper-fab white-text text-darken-4" on-click="newRequest"></paper-fab>-->
                </div>
            </paper-header-panel>
        </paper-drawer-panel>


        <!-- Request Details Overlay-->
        <div id="details_overlay" class="overlay-cover layout horizontal center-center" style="width:100%; height:100% !important; z-index:10000 !important; position:absolute; display:none;">
            <div id="details_overlay_content" class="white overlay-card" style="width:100%; max-width:1000px; height:92% !important; border-radius:5px;">
                <div class="layout vertical white" style="border-radius:5px;">
                    <div class="layout horizontal">
                        <div class="flex"></div>
                        <a id="close_overlay" class="grey-text" style="cursor:pointer !important; margin:7px 7px 0 0;" on-click="closeOverlay">
                            <i class="material-icons small" style="font-size:2rem;">cancel</i>
                        </a>
                    </div>
                </div>

                <div id="overlay_details" style="height:92%; overflow:auto;">
                </div>
            </div>
        </div>
    </template>
</dom-module>

<script>
    (function(window) {
        var constructor = Polymer({

        	is: 'recent-requests',

            /**
             * ...
             *
             * @attribute properties
             * @type object
             * @default
             */
            properties: {
                firebase: {
                    requests: null,
                    games: null,
                    users: null
                },
                name: 'Requests Page',

                /**
                 * ...
                 *
                 * @attribute thingName
                 * @type string
                 * @default ''
                 */
				notify: true
            },

        	/* Functions */
            addNeutralTag: function (node) {
            	$(node).addClass('tag-neutral');
            },

            addSpinnerRoo: function () {
            	$('.spinner-roo-item').show();
            },

            activateFilterTag: function (e) {
            	var cusElem = this;
            	var system = e.target.dataset.system;

            	$('.filter-tags').each(function () {
            		cusElem.clearSystemTagClass($(this).get(0));
            	});

            	switch (system) {

            		case 'pc':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('pc-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'pc';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;

            		case 'ps3':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('psn-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'ps3';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;

            		case 'ps4':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('psn-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'ps4';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;

            		case 'xbox360':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('xbox-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'xbox360';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;

            		case 'xboxOne':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('xbox-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'xboxOne';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;

            		case 'wii':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('wii-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'wii';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;

            		case 'wiiu':
            			if (!$(e.target).hasClass('filter-active')) {
            				cusElem.clearActiveTag(e.target);
            				cusElem.clearNeutralTagClass(e.target);
            				$(e.target).addClass('wii-filter-tag');
            				$(e.target).addClass('filter-active');
            				cusElem.systemFilter = 'wiiu';
            				if (cusElem.dataops.query === null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.bysystem, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, false);
            				}
            			}
            			else {
            				if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
            					cusElem.getRequests(null, cusElem.querytype.none, false);
            				}
            				else {
            					cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, false);
            				}
            				$(e.target).removeClass('filter-active');
            				cusElem.systemFilter = 'none';
            			}
            			break;
            	}
            },

            authDataCallback: function (authData) {
                var cusElem = this;

                if (authData) {
                    //console.log("User " + authData.uid + " is logged in with " + authData.provider);
                } else {
                    //Check to make sure the user is logged out...
                    cusElem.loggedIn = false;
                    cusElem.notifyPath('loggedIn', cusElem.loggedIn);

                    //navigate them to the sign-in page
                    document.querySelector('app-router').go('/login');
                }
            },

            blockContent: function () {
                var html = '<div class="layout fit vertical center white" style="padding:0 20px;">';
                html += '<div class="layout vertical">'
                html += '<h3 class="orange-text text-darken-3" >Oh Noez!!! Why you no sign in!</h3><br><br>'
                html += '<img src="../assets/app/img/why_no_guy.png" /><br><br>';
                html += '<h4 class="orange-text text-darken-3" style="font-size:1.5rem;">Sorry, but you need to be signed in to view the this page</h4></div>'
                html += '<h6 class="orange-text text-darken-3">Click the Sign In button located in the side navigation panel on the left, or click <a href="#/" class="blue-text" style="cursor:pointer;">here</a> to go to the requests page</h6>'
                html += '</div>';

                $(this.$.recent_requests_content).html(html);
                $('.filter-row').remove();
            },

            clearActiveTag: function (exceptionNode) {
            	$('.filter-tags').each(function () {
            		if ($(this).data('system') !== $(exceptionNode).data('system')) {
            			$(this).removeClass('filter-active');
            		}
            	});
            },

            clearFirebaseCallbacks: function () {
                var cusElem = this;
                if (name !== null && name !== undefined && name !== '') {
                    var callbacks = _.findWhere(cusElem.firebaseRefs, { name: name });
                    if (callbacks) {
                        if (callbacks.isArray) {
                            _.each(callbacks, function (ref, index) {
                                //Detach all currently attached firebase callbacks. Only one should be attached at one time
                                ref.value.off(ref.type, ref.functionRef);
                                cusElem.firebaseRefs.splice(cusElem.firebaseRefs.indexOf(ref), 1);
                            });
                        }
                        else {
                            callbacks.value.off(callbacks.type, callbacks.functionRef);
                            cusElem.firebaseRefs.splice(cusElem.firebaseRefs.indexOf(callbacks), 1);
                        }
                    }
                }
                else {
                    if (cusElem.firebaseRefs.length > 0) {
                        var clone = cusElem.firebaseRefs.slice(0);
                        _.each(clone, function (ref, index) {
                            //Detach all currently attached firebase callbacks. Only one should be attached at one time
                            ref.value.off(ref.type, ref.functionRef);
                            cusElem.firebaseRefs.splice(cusElem.firebaseRefs.indexOf(ref), 1);
                        });
                    }
                }
            },

            clearNeutralTagClass: function (node) {
            	$(node).removeClass('tag-neutral');
            },

            clearSystemTagClass: function (node) {
            	var system = node.dataset.system;

            	switch (system) {

            		case 'pc':
            			$(node).removeClass('pc-filter-tag');
            			this.addNeutralTag(node);
            			break;

            		case 'ps3':
            			$(node).removeClass('psn-filter-tag');
            			this.addNeutralTag(node);
            			break;

            		case 'ps4':
            			$(node).removeClass('psn-filter-tag');
            			this.addNeutralTag(node);
            			break;

            		case 'xbox360':
            			$(node).removeClass('xbox-filter-tag');
            			this.addNeutralTag(node);
            			break;

            		case 'xboxOne':
            			$(node).removeClass('xbox-filter-tag');
            			this.addNeutralTag(node);
            			break;

            		case 'wii':
            			$(node).removeClass('wii-filter-tag');
            			this.addNeutralTag(node);
            			break;

            		case 'wiiu':
            			$(node).removeClass('wii-filter-tag');
            			this.addNeutralTag(node);
            			break;
            	}
            },

            closeOverlay: function () {
            	$(this.$.details_overlay).fadeOut();
            	this.$.overlay_details.innerHTML = '';
            },

            changeSort: function (e) {
            	var anchor_elem = e.target;
            	this.dataops.sort = anchor_elem.dataset.sort;

            	//this.getRequests(this.dataops.sort, true);
            	this.getRequests(null, this.querytype.none, false);
            },

            containerScroll: function (e) {
                var cusElem = this;
                var container = e.target;
                if (container.offsetHeight + container.scrollTop >= container.scrollHeight) {
                    // reached bottom of page - run our call for pagination

                    if (cusElem.dataops.query == null || cusElem.dataops.query === undefined || cusElem.dataops.query === '') {
                        if (cusElem.systemFilter !== null && cusElem.systemFilter !== undefined && cusElem.systemFilter !== '' && cusElem.systemFilter !== 'none') {
                            cusElem.getRequests(null, cusElem.querytype.bysystem, true);
                        }
                        else {
                            cusElem.getRequests(null, this.querytype.none, true);
                            /*cusElem.getRequests(null, cusElem.dataops.querytype, true);*/
                        }
                    }
                    else {
                        if (cusElem.systemFilter !== null && cusElem.systemFilter !== undefined && cusElem.systemFilter !== '' && cusElem.systemFilter !== 'none') {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bysystem, true);
                        }
                        else {
                            cusElem.getRequests(cusElem.dataops.query, cusElem.querytype.bygame, true);
                            /*cusElem.getRequests(cusElem.dataops.query, cusElem.dataops.querytype, true);*/
                        }
                    }
                }
            },

            doSearch: function (e) {
            	var query = $('#search_input').val();

            	if ((e.keyCode || e.which) === 13) {
            		/* so the idea here is to take a the text and do a "LIKE" type of query to firebase using "startAt" and "endAt".
					 * I'm not sure atm, whether if/when the user selects the suggested option within the search window, I want to -
					 * still do a "LIKE" search or do an "EQUAL TO" search. The user might select the title "Street Fighter" but actually
					 * not want street fighter from the 80s, but street fighter  4. Cuz we are using Giant Bomb as reference, whats returned in the
					 * autocomplete ties to a gameid.
					 *
					 * For now, I'm going to always do a "LIKE" Search. We'll see how it plays out :| */
            		query = query !== null && query !== undefined && query !== '' ? window.lfg.utils.clearWhiteSpace(query) : '';
            		this.dataops.query = query;		//save the query incase we need it for scrolling
            		//this.getRequests(this.dataops.sort, true, query.toLowerCase());

            		//Account for the system filters
            		if (this.systemFilter !== null && this.systemFilter !== undefined && this.systemFilter !== '' && this.systemFilter !== 'none') {
            			this.getRequests(query.toLowerCase(), this.querytype.bysystem, false);
            		}
            		else {
            			if (query !== null && query !== undefined && query !== '') {
            				this.getRequests(query.toLowerCase(), this.querytype.bygame, false);
            			}
            			else {
            				this.getRequests(null, this.querytype.none, false);
            			}
            		}
            		//this.getRequests(query.toLowerCase(), this.querytype.bygame, false);
            		$('#search_dropdown').fadeOut(100);
            	}
            	else {
            		var url = window.lfg.config.getGiantBombUrl(window.lfg.config.apiEndPoints.search);

            		$.ajax({
            			url: url,
            			type: 'GET',
            			cache: false,
            			data: { search: query, limit: 4 },
            			dataType: 'json',
            			success: function (data) {
            				var html = '<li class="divider search-result-item"></li>';
            				$('#search_dropdown').find('.search-result-item').remove();

            				_.each(data.results, function (result) {
            					html += '<li class="search-result-item" data-result-id="' + result.id + '" style="padding: 7px 0px 7px 8.2%;">';

            					if (
									result.image !== null && result.image !== undefined &&
									result.image.screen_url !== null &&
									result.image.screen_url !== undefined &&
									result.image.screen_url !== '') {
            						html += '<span><span><img src="' + result.image.screen_url + '" width="100" style="margin-right:30px;" /></span>';
            					}
            					else {
            						html += '<span style="background-color:#FB8C00; width:100px; height:56px;"></span>';
            					}

            					html += '<span style="margin-top:-7px !important;"><a class="search-result-link orange-text text-darken-3">' + result.name + '</span></a></span></li>';
            				});
            				$('#search_dropdown').append(html);
            			},
            			error: function (err) {
            			}
            		});
            	}
            },

            doResultSearchWithClick: function (e) {
            	var polymer = this;		//bound to polymer elem
            	var anchor = e.target;

            	var li = $(anchor).parent();
            	var giantbombid = $(li).data('resultId');
            	var game = $(anchor).html().toLowerCase();
            	game = window.lfg.utils.clearWhiteSpace(game);

            	//Account for the system filters
            	if (this.systemFilter !== null && this.systemFilter !== undefined && this.systemFilter !== '' && this.systemFilter !== 'none') {
            		polymer.getRequests(game, polymer.querytype.bysystem, false);
            	}
            	else {
            		polymer.getRequests(game, polymer.querytype.bygame, false);
            	}
            	e.preventDefault();
            },

            formatDate: function (utc) {
            	return window.lfg.utils.convertUtcToLocal(utc);
            },

            getRequests: function (query, querytype, paginate) {
                //userid
                var userid = window.lfg.utils.getUser();
            	var customElem = this

            	if (userid !== null && userid !== undefined && userid !== '') {

            	    var recentRequestsRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + userid + '/recentrequests');

            		if (paginate) {
            		    var lastRecentRequest = customElem.recentRequests[customElem.recentRequests.length - 1];
            		    var lastrequest = lastRecentRequest.request;

            		    //no query, so just go by priority
            		    //save the query & type (for pagination)
            		    customElem.dataops.querytype = querytype;

            		    var refFunc = recentRequestsRef
                                .orderByChild('requestindex')
                                .startAt(lastRecentRequest.requestindex)
                                .limitToFirst(customElem.dataops.limit + 1)
                                .once("value", function (snapshot) {
                                    snapshot.forEach(function (childSnapshot) {
                                        var recentRequest = childSnapshot.val();
                                        var requestRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'requests/' + recentRequest.requestid);

                                        requestRef
                                            .once("value", function (reqSnapshot) {
                                                var request = reqSnapshot.val() || {};
                                                request.key = reqSnapshot.key();
                                                request.priority = reqSnapshot.getPriority();
                                                request.systemColor = customElem.getSystemColor(request.system);
                                                request.description = customElem.truncateText(request.description, 65);
                                                request.title = customElem.truncateText(request.title, 35);
                                                request.profilepicid = customElem.getImageId(request.key);
                                                customElem.getUserProfile(request);
                                                customElem.getCommentCount(request.key);

                                                recentRequest.request = request;

                                                if (request.priority !== lastrequest.priority) {
                                                    if ((-1 * recentRequest.index) >= customElem.firebaseTimestamp) {
                                                        customElem.firebaseTimestamp = (-1 * request.index);
                                                        customElem.unshift('recentRequests', recentRequest);
                                                    }
                                                    else {
                                                        customElem.push('recentRequests', recentRequest);
                                                    }
                                                    customElem.notifyPath('requests', customElem.requests);
                                                };

                                                customElem.removeSpinnerRoo();
                                            }, function (errorObject) {
                                                console.log("The read failed: " + errorObject.code);
                                            });
                                    });
                                }, function (errorObject) {
                                    console.log("The read failed: " + errorObject.code);
                                });

            		    var timeout = setTimeout(function () {
            		        if (customElem.recentRequests == null || customElem.recentRequests == undefined || customElem.recentRequests.length <= 0) {
            		            customElem.removeSpinnerRoo();
            		            customElem.showNoRecordsMessage();
            		        }
            		    }, 5000);

            		    //Store the firebaseRef so we can access it later to detach any callbacks
            		    customElem.firebaseRefs.push({
            		        name: 'recentrequests_paginate',
            		        type: 'child_added',
            		        value: recentRequestsRef,
            		        functionRef: refFunc
            		    });
            		}
            		else {
            		    customElem.requests = [];
            		    customElem.recentRequests = [];
            		    
            		    customElem.removeNoRecordsMessage();
            		    customElem.addSpinnerRoo();

            		    //Detach all firebase callbacks
            			customElem.clearFirebaseCallbacks();

            		    //save the query & type (for pagination)
            			customElem.dataops.querytype = querytype;

            			var refFunc = recentRequestsRef
                                        .orderByChild('requestindex')
                                        .limitToFirst(customElem.dataops.limit)
                                        .on("child_added", function (snapshot) {

                                            var recentRequest = snapshot.val();
                                            var requestRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'requests/' + recentRequest.requestid);

                                            requestRef
                                                .once("value", function (snapshot) {
                                                    var request = snapshot.val() || {};
                                                    request.key = snapshot.key();
                                                    request.priority = snapshot.getPriority();
                                                    request.systemColor = customElem.getSystemColor(request.system);
                                                    request.description = customElem.truncateText(request.description, 65);
                                                    request.title = customElem.truncateText(request.title, 35);
                                                    request.profilepicid = customElem.getImageId(request.key);
                                                    customElem.getUserProfile(request);
                                                    customElem.getCommentCount(request.key);

                                                    //make the request a child item of the recentRequests
                                                    recentRequest.request = request;

                                                    if ((-1 * recentRequest.index) >= customElem.firebaseTimestamp) {
                                                        customElem.firebaseTimestamp = (-1 * request.index);
                                                        customElem.unshift('recentRequests', recentRequest);
                                                    }
                                                    else {
                                                        customElem.push('recentRequests', recentRequest);
                                                        customElem.requestRetrievalCounter += 1;
                                                    }

                                                    customElem.removeSpinnerRoo();
                                                }, function (errorObject) {
                                                    console.log("The read failed: " + errorObject.code);
                                                });
                                            
                                        }, function (errorObject) {
                                            console.log("The read failed: " + errorObject.code);
                                        });

            		    //Listen to the "child_removed" event - incase the user views a previously-viewed request again
            			//recentRequestsRef.on('child_removed', function (oldChildSnapshot) {
            			//    // remove child from requests array
            			//    var oldRecRequest = oldChildSnapshot.val();
            			//    var foundRequest = _.findWhere(customElem.requests, { requestid: oldRecRequest.requestid });

            			//    if (foundRequest) {
            			//        customElem.requests.splice(customElem.requests.indexOf(foundRequest), 1);
            			//        customElem.notifyPath('requests', customElem.requests);
            			//    }
            		    //});

            			var timeout = setTimeout(function () {
            			    if (customElem.recentRequests == null || customElem.recentRequests == undefined || customElem.recentRequests.length <= 0) {
            			        customElem.removeSpinnerRoo();
            			        customElem.showNoRecordsMessage();
            			    }
            			}, 5000);

            		    //Store the firebaseRef so we can access it later to detach any callbacks
            			customElem.firebaseRefs.push({
            			    name: 'recentrequests_nopaginate',
            			    type: 'child_added',
            			    value: recentRequestsRef,
            			    functionRef: refFunc
            			});
            		}
            	}
            },

            getCommentCount: function (requestid) {
            	var customElem = this
            	var commentsRef = customElem.firebaseRef.child('comments');

            	commentsRef
					.orderByChild('requestkey')
					.equalTo(requestid)
					.once('value', function (snapshot) {
						var comment = snapshot.val();

						if (comment) {
							var request = _.findWhere(customElem.requests, { key: requestid });

							if (request) {
								request.commentCount = request.commentCount ? request.commentCount + 1 : 1;
							}
						}
					});
            },

            getImageId: function (key) {
                var string = window.lfg.utils.randomShortString(10);
            	return 'img' + key + string;
            },

            getTimeLapse: function (date) {
            	var convDate = new Date(date);
            	return window.lfg.utils.timeSince(window.lfg.utils.convertUtcToLocalDate(convDate));
            },

            getUserProfile: function (request) {
                var cusElem = this;
                var userImageRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + request.uid + '/profilepic');
                userImageRef.once("value", function (snapshot) {
                    var profilepic = snapshot.val();
                    if (profilepic !== null && profilepic !== undefined && profilepic !== '') {
                        var profileImage = document.getElementById(request.profilepicid);

                        if (profileImage !== null && profileImage !== undefined) {
                            profileImage.src = profilepic;
                        }
                    }
                });
            },

            getGamerCount: function (count) {
                if (count <= 1) {
                    return '1';
                }
                else {
                    return count;
                }
            },


            getSystemType: function (system) {

            	switch (system) {

            		case 'pc':
            			return 'PC';
            			break;

            		case 'ps3':
            			return 'PS3';
            			break;

            		case 'ps4':
            			return 'PS4';
            			break;

            		case 'xbox360':
            			return 'X360';
            			break;

            		case 'xboxOne':
            			return 'X1';
            			break;

            		case 'wii':
            			return 'Wii';
            			break;

            		case 'wiiu':
            			return 'Wii U';
            			break;
            	}
            },

            getSystemColor: function (system) {

            	switch (system) {

            		case 'pc':
            			return 'background-color: #f44336;';
            			break;

            		case 'ps3':
            			return 'background-color: #01579b;';
            			break;

            		case 'ps4':
            			return 'background-color: #01579b;';
            			break;

            		case 'xbox360':
            			return 'background-color: #5DCB17;';
            			break;

            		case 'xboxOne':
            			return 'background-color: #5DCB17;';
            			break;

            		case 'wii':
            			return 'background-color: #03a9f4;';
            			break;

            		case 'wiiu':
            			return 'background-color: #03a9f4;';
            			break;
            	}
            },

            goToList: function () {
                document.querySelector('app-router').go('/');
            },

            hideMessage: function (e) {
            	$('#signin_message').slideUp();
            },

            isImageBlank: function (url) {
            	return (url == null || url == undefined || url == '');
            },

            isLoggedIn: function () {
                var cusElem = this;

                if (window.lfg.utils.isLoggedIn()) {
                    var userRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + authData.uid);

                    //Get the user profile info. If none exists, redirect to Onboarding process...
                    userRef
                        .once('value', function (snapshot) {
                            var user = snapshot.val();
                            if (user === null || user === undefined || user.setupcomplete === null || user.setupcomplete === undefined || user.setupcomplete === '' || user.setupcomplete === false) {
                                cusElem.blockContent();
                            }
                            else {
                                cusElem.loggedIn = true;
                                $('.filter-row').show();
                            }
                        });
                }
                else {
                    cusElem.blockContent();
                }
            },

            isLoggedOut: function () {
                var cusElem = this;

                if (window.lfg.utils.isLoggedIn()) {
                    var userRef = new Firebase(window.lfg.config.getFirebaseUrl() + 'users/' + authData.uid);

                    //Get the user profile info. If none exists, redirect to Onboarding process...
                    userRef
                        .once('value', function (snapshot) {
                            var user = snapshot.val();
                            //redirect to user setup page
                            if (user === null || user === undefined || user.setupcomplete === null || user.setupcomplete === undefined || user.setupcomplete === '' || user.setupcomplete === false) {
                                cusElem.loggedOut = true;
                            }
                            else {
                                cusElem.loggedOut = false;
                            }
                        });
                }
            },

            loadRequest: function (e) {
            	var listelem = e.target;
            	if (listelem.className.indexOf('request-card-item') === -1 && listelem.className.indexOf('request-list-item') === -1) {
            		var elem = $(listelem).parents('.request-card-item')[0];
            		listelem = elem === null || elem === undefined ? $(listelem).parents('.request-list-item')[0] : elem;
            	}

            	var requestkey = listelem.dataset.requestKey;
            	if (requestkey) {
            		//document.querySelector('app-router').go('/request/' + requestkey);
            		//var detailsHtml = '<request-details-overlay requestkey="' + requestkey + '"></request-details-overlay>';
            		var dynamicEl = document.createElement("request-details-overlay");

            		//dynamicEl.requestkey = this.requestkey;
            		dynamicEl.setAttribute('requestkey', requestkey);
            		this.$.overlay_details.innerHTML = '';
            		this.$.overlay_details.appendChild(dynamicEl);
            		$(this.$.details_overlay).fadeIn();
            	}
            },

            removeSpinnerRoo: function () {
            	$('.spinner-roo-item').hide();
            },

            removeNoRecordsMessage: function () {
                $('.no-more-records-item').hide();
            },

            showNoRecordsMessage: function () {
                $('.no-more-records-item').fadeIn();
            },

            showFilter: function () {
            	$(this.$.filter_modal).openModal();
            },

            showSearch: function () {
                $(this.$.search_dropdown).fadeIn(100, function () {
                    $('#search_input').focus();
                });
            },

            truncateText: function (text, limit) {
				//TODO: Factor in the window/screen size
            	return text.length <= limit ? text : text.substring(0, limit) + '...';
            },


			/* Init */
            initializeData: function () {
                this.loggedIn = null;
                this.loggedOut = null;

                this.isLoggedIn();
                this.isLoggedOut();

            	this.firebaseUrl = window.lfg.config.getFirebaseUrl() + '/requests';

            	this.systems = [
					{ name: 'PC', value: 'pc' },
					{ name: 'PS3', value: 'ps3' },
					{ name: 'PS4', value: 'ps4' },
					{ name: 'Xbox 360', value: 'xbox360' },
					{ name: 'Xbox One', value: 'xboxOne' },
					{ name: 'Wii', value: 'wii' },
					{ name: 'Wii U', value: 'wiiu' }
            	];

            	this.sortoptions = [
					{ name: 'Date Created', column: 'created' },
					{ name: 'Game', column: 'game' },
            	];

            	this.querytype = {
            		bygame: 'bygame',
            		byid: 'byid',
					bysystem: 'bysystem',
					none: 'none'
            	};

            	this.systemFilter = 'none';

            	this.dataops = {
					orderby: '',
            		sort: 'created',
            		filter: '',
            		query: '',
            		type: this.querytype.none,
					limit: 10,
            	}

            	this.firebaseRef = new Firebase(window.lfg.config.getFirebaseUrl());
            	this.firebaseRefs = [];
            	this.firebaseTimestamp = window.lfg.utils.convertDateToUtc(Date.now());

            	this.requests = [];
            	this.recentRequests = [];

                //hide elements
            	$(this.$.filter_modal).hide();
            	$(this.$.search_dropdown).hide();
            },

            registerEvents: function () {
            	$('#search_input').on('focusout', function () { $('#search_dropdown').fadeOut(100); })
            	$('#search_input').on('keypress', this.doSearch.bind(this));
            	$('#mainContainer').scroll(this.containerScroll.bind(this));
            	$(document).on('click', '.search-result-link', this.doResultSearchWithClick.bind(this));
            	$('.filter-tags').click(this.activateFilterTag.bind(this));

                //clear all auth callbacks
            	window.lfg.config.detachAllAuthCallbacks();

            	var ref = new Firebase(window.lfg.config.getFirebaseUrl());
            	var authCallbackFunc = this.authDataCallback.bind(this);
            	window.lfg.config.firebaseAuthCallbacks.push(authCallbackFunc);
            	ref.onAuth(authCallbackFunc);
            },

            registerPlugins: function() {
            	$(this.$.sort_menu).dropdown({
            		inDuration: 300,
            		outDuration: 225,
            		constrain_width: false, // Does not change width of dropdown to that of the activator
            		hover: false, // Activate on hover
            		gutter: 0, // Spacing from edge
            		belowOrigin: false // Displays dropdown below the button
            	});
            },

			/* Events */
            newRequest: function (e) {
            	e.preventDefault();
                document.querySelector('app-router').go('/new');
            },

            ready: function () {
            	this.initializeData();
            },

            attached: function () {
                //this.getRequests(this.dataops.sort);
                this.getRequests(null, this.querytype.none, false);
                this.registerPlugins();
                this.registerEvents();
            }
        });
    })(window);
</script>

<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-66975307-1', 'auto');
 ga('send', 'pageview');

</script>